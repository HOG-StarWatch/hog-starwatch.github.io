# TDL Manager 脚本使用说明

## 简介
`TDL.bat` 是一个用于管理和使用 [TDL (Telegram Downloader)](https://github.com/iyear/tdl) 的 Windows 批处理脚本。它提供了一个直观的命令行菜单界面，旨在简化 `tdl` 命令行工具的复杂操作，让用户能够轻松地进行安装、登录、导出聊天记录以及下载文件。

## 功能特性

本脚本主要包含以下五大功能模块：

### 1. 安装与更新 (Install & Update)
*   **一键安装**: 自动检测环境并调用官方 PowerShell 脚本将 `tdl` 安装到系统目录。
*   **自动提权**: 如果需要写入系统目录，脚本会自动请求管理员权限。
*   **版本更新**: 可用于更新现有的 `tdl` 程序到最新版本。

### 2. 登录 (Login)
提供多种登录方式以适应不同场景：
*   **直接登录**: 标准的交互式登录流程。
*   **自定义路径登录**: 指定 Telegram Desktop 的数据路径进行登录（无需再次输入验证码）。
*   **二维码登录**: 生成二维码，使用手机 Telegram 扫码登录。
*   **验证码登录**: 使用手机号码和短信/应用内验证码登录。

### 3. 导出 (Export)
*   **查看列表**: 列出当前的对话列表 (Chat List)。
*   **导出配置**: 将指定聊天对象的记录导出为 JSON 配置文件。
    *   支持多种标识符：`@username`、无 @ 的用户名、Chat ID、公开链接或手机号。
    *   支持导出 "收藏夹" (Saved Messages)。

### 4. 下载参数设置 (Download Settings)
可视化配置下载参数，配置会自动保存到同目录下的 `config` 文件中：
*   **跳过已存在**: (`--skip-same`) 是否跳过文件名相同的文件。
*   **线程数**: (`-t`) 设置下载时的线程数量（默认 8）。
*   **并发任务**: (`-l`) 设置同时进行的下载任务数（默认 4）。
*   **下载目录**: (`-d`) 自定义文件保存路径（支持绝对路径）。
*   **JSON 文件**: (`-f`) 指定用于下载的 JSON 配置文件名。
*   **白名单**: (`-i`) 仅下载指定扩展名的文件（如 `jpg,png`）。
*   **黑名单**: (`-e`) 排除指定扩展名的文件（如 `zip,exe`）。

### 5. 下载 (Download)
*   **从 JSON 下载**: 读取导出步骤生成的 JSON 文件进行批量下载。
*   **从链接下载**: 直接粘贴 Telegram 消息链接或频道链接进行下载（支持多链接批量下载）。

## 使用指南

1.  **启动**: 双击运行 `TDL.bat`。
2.  **初次使用**:
    *   输入 `1` 并回车，安装 `tdl` 核心程序。
    *   输入 `2` 并回车，选择一种方式登录你的 Telegram 账号。
3.  **下载资源**:
    *   **方式 A (推荐)**: 先选 `3` 导出想要下载的聊天记录为 JSON，然后选 `5` -> `1` 开始下载。
    *   **方式 B (快捷)**: 直接选 `5` -> `2`，粘贴消息链接直接下载。
4.  **调整设置**: 随时可选 `4` 调整下载目录或过滤规则。

## 常见问题

*   **乱码问题**: 脚本已内置 `chcp 65001` 命令，请确保在支持 UTF-8 的终端（如 Windows Terminal 或较新的 CMD）中运行。
*   **权限提示**: 安装过程中可能会弹出 UAC 提示框，请点击“是”以允许脚本进行安装操作。
*   **找不到 tdl.exe**: 请先运行菜单选项 `1` 进行安装，或者手动将 `tdl.exe` 放入脚本所在目录或添加到系统 PATH 环境变量中。

## 文件结构
*   `TDL.bat`: 主程序脚本。
*   `config`: 配置文件（首次保存设置后自动生成）。
*   `tdl-export.json`: 默认的导出配置文件名。

---
*注意：本脚本仅为 tdl 的第三方辅助工具，核心下载功能由 tdl 提供。*
