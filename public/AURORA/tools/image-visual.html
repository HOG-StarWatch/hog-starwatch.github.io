<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视觉变换</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* Mobile Scroll Fix */
        @media (max-width: 768px) {
            body {
                height: auto !important;
                overflow-y: auto !important;
                display: block !important;
            }
            .workspace {
                height: auto !important;
                overflow: visible !important;
                min-height: 600px;
            }
            #tool-frame {
                min-height: 600px;
            }
        }
    </style>
</head>
<body style="padding: 1rem;">
    <div class="sub-tab-group">
        <div class="sub-tab" onclick="switchTool('pixel', this)">图片像素化</div>
        <div class="sub-tab" onclick="switchTool('photon', this)">通用滤镜 (General)</div>
        <div class="sub-tab" onclick="switchTool('ascii', this)">ASCII 艺术</div>
        <div class="sub-tab" onclick="switchTool('glitch', this)">Glitch 艺术</div>
        <div class="sub-tab" onclick="switchTool('crypto', this)">视觉加密</div>
        <div class="sub-tab" onclick="switchTool('overlay', this)">图片重叠合成</div>
        <div class="sub-tab" onclick="switchTool('fun', this)">趣味图</div>
        <div class="sub-tab" onclick="switchTool('drawing', this)">色板转换</div>
    </div>

    <div class="workspace" style="padding: 0; overflow: auto;">
        <iframe id="tool-frame" src="image-pixel.html" style="width:100%; height:100%; border:none;"></iframe>
    </div>
    
    <script src="../js/app.js"></script>
    <script>
        // Theme Propagation Helper
        function propagateThemeToChild() {
            const frame = document.getElementById('tool-frame');
            if(!frame || !frame.contentWindow) return;
            
            const root = document.documentElement;
            const vars = [
                '--bg-deep', '--bg-panel', '--bg-header', '--primary', '--secondary', '--accent', 
                '--text-main', '--text-dim', '--border', '--shadow', '--primary-contrast',
                '--radius-lg', '--radius-md', '--radius-sm', '--font-main', '--font-mono',
                '--input-bg', '--btn-bg', '--btn-hover-bg'
            ];
            
            try {
                const childRoot = frame.contentWindow.document.documentElement;
                vars.forEach(v => {
                    const val = getComputedStyle(root).getPropertyValue(v);
                    if(val) childRoot.style.setProperty(v, val);
                });
            } catch(e) {
                console.log('Cannot propagate theme to cross-origin frame');
            }
        }

        const toolFrame = document.getElementById('tool-frame');
        toolFrame.addEventListener('load', propagateThemeToChild);
        
        // Also listen for theme changes from parent (MutationObserver)
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    propagateThemeToChild();
                }
            });
        });
        observer.observe(document.documentElement, { attributes: true });

        function switchTool(tool, el) {
            document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            const frame = document.getElementById('tool-frame');
            switch(tool) {
                case 'pixel': frame.src = 'image-pixel.html'; break;
                case 'photon': frame.src = 'image-photon.html'; break;
                case 'ascii': frame.src = 'image-ascii.html'; break;
                case 'glitch': frame.src = 'image-glitch.html'; break;
                case 'crypto': frame.src = 'image-crypto.html'; break;
                case 'overlay': frame.src = 'image-overlay.html'; break;
                case 'fun': frame.src = 'image-fun.html'; break;
                case 'drawing': frame.src = 'image-drawing.html'; break;
                case 'seeder': frame.src = 'image-seeder.html'; break;
                case 'file-qrcode': frame.src = 'file-qrcode.html'; break;
            }
        }
    </script>
</body>
</html>