<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå…‰å·¥å…·ç®± (Aurora Toolbox)</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="css/style.css">
    <style>
        body { overflow: hidden; }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            flex: 1;
            display: block;
        }
        main {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <header>
        <div style="display:flex; align-items:center; width: 100%; justify-content: space-between; height: 100%;">
            <div style="display:flex; align-items:center; height: 100%;">
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" onclick="toggleMobileMenu()" style="display:none; background:none; border:none; color:var(--text-main); font-size:1.5rem; margin-right:15px; cursor:pointer;">
                    â˜°
                </button>
                <div class="logo" style="cursor: pointer;" onclick="switchToHome()">AURORA <span style="font-weight:300; opacity:0.7">TOOLBOX</span></div>
            </div>
            
            <div style="display:flex; align-items:center; height: 100%;">
                <nav class="nav-tabs" id="main-nav">
                    <button class="btn" onclick="window.location.href = window.location.origin">
                    <span>â†©â¤â†©</span>
                    </button>   
                    <button class="tab-btn active" data-src="tools/home.html">å·¥å…·ç®±ä¸»é¡µ</button>
        
                    <!-- Image Dropdown -->
                    <div class="dropdown">
                        <button class="tab-btn dropdown-toggle">å›¾å½¢å›¾åƒ</button>
                        <div class="dropdown-content">
                            <div class="dropdown-header">åŸºç¡€ç¼–è¾‘</div>
                            <button class="tab-btn" data-src="tools/image-convert.html">æ ¼å¼è½¬æ¢</button>
                            <button class="tab-btn" data-src="tools/image-svg-tracer.html">SVG çŸ¢é‡åŒ–</button>
                            <button class="tab-btn" data-src="tools/image-gif.html">GIF åˆ¶ä½œ</button>
                            <button class="tab-btn" data-src="tools/image-svg-painter.html">SVG ç”»æ¿</button>
                            <button class="tab-btn" data-src="tools/image-svg-optimizer.html">SVG ä¼˜åŒ–å™¨</button>
                            <button class="tab-btn" data-src="tools/image-drawing.html">ç®€æ˜“ç»˜å›¾</button>
                            <button class="tab-btn" data-src="tools/image-overlay.html">å›¾ç‰‡å åŠ </button>
                            
                            <div class="dropdown-divider"></div>
                            <div class="dropdown-header">ç‰¹æ•ˆæ»¤é•œ</div>
                            <button class="tab-btn" data-src="tools/image-photon.html">ä¸“ä¸šæ»¤é•œ</button>
                            <button class="tab-btn" data-src="tools/image-pixel.html">åƒç´ åŒ–</button>
                            <button class="tab-btn" data-src="tools/image-glitch.html">æ•…éšœè‰ºæœ¯</button>
                            <button class="tab-btn" data-src="tools/image-ascii.html">å­—ç¬¦ç”»</button>
                            <button class="tab-btn" data-src="tools/image-visual.html">è§†è§‰ç‰¹æ•ˆ</button>

                            <div class="dropdown-divider"></div>
                            <div class="dropdown-header">åŠ å¯†ä¸ç”Ÿæˆ</div>
                            <button class="tab-btn" data-src="tools/image-crypto.html">è§†è§‰åŠ å¯†</button>
                            <button class="tab-btn" data-src="tools/image-phantom.html">å¹»å½±å¦å…‹</button>
                            <button class="tab-btn" data-src="tools/image-hybrid.html">æ··åˆå›¾åƒ</button>
                            <button class="tab-btn" data-src="tools/image-seeder.html">å›¾ç§ç”Ÿæˆ</button>
                            <button class="tab-btn" data-src="tools/image-fun.html">è¶£å‘³ç”Ÿæˆ</button>
                        </div>
                    </div>

                    <!-- Text Dropdown -->
                    <div class="dropdown">
                        <button class="tab-btn dropdown-toggle">æ–‡æœ¬ä»£ç </button>
                        <div class="dropdown-content">
                            <button class="tab-btn" data-src="tools/text.html">æ–‡æœ¬å¤„ç†</button>
                            <button class="tab-btn" data-src="tools/transcode.html">æ–‡æœ¬è½¬ç </button>
                            <button class="tab-btn" data-src="tools/format.html">ä»£ç æ ¼å¼åŒ–</button>
                            <button class="tab-btn" data-src="tools/diff.html">æ–‡æœ¬å¯¹æ¯”</button>
                            <button class="tab-btn" data-src="tools/markdown.html">Markdown</button>
                            <div class="dropdown-divider"></div>
                            <button class="tab-btn" data-src="tools/encrypt.html">åŠ å¯†è§£å¯†</button>
                            <button class="tab-btn" data-src="tools/obfuscator.html">HTML æ··æ·†</button>
                        </div>
                    </div>
        
                    <!-- File Dropdown -->
                    <div class="dropdown">
                        <button class="tab-btn dropdown-toggle">æ–‡ä»¶æ•°æ®</button>
                        <div class="dropdown-content">
                            <button class="tab-btn" data-src="tools/file.html">æ–‡ä»¶å¤„ç†</button>
                            <button class="tab-btn" data-src="tools/file-encoding.html">æ–‡ä»¶ç¼–ç </button>
                            <button class="tab-btn" data-src="tools/file-qrcode.html">æ–‡ä»¶äºŒç»´ç </button>
                            <div class="dropdown-divider"></div>
                            <button class="tab-btn" data-src="tools/datetime.html">æ—¶é—´å·¥å…·ç®±</button>
                            <button class="tab-btn" data-src="tools/unit.html">å•ä½æ¢ç®—</button>
                            <div class="dropdown-divider"></div>
                            <button class="tab-btn" data-src="tools/hash.html">å“ˆå¸Œè®¡ç®—</button>
                            <button class="tab-btn" data-src="tools/generator.html">æ•°æ®ç”Ÿæˆ</button>
                            <button class="tab-btn" data-src="tools/qrcode.html">äºŒç»´ç </button>
                        </div>
                    </div>
        
                    <!-- Network Dropdown -->
                    <div class="dropdown">
                        <button class="tab-btn dropdown-toggle">ç½‘ç»œç›¸å…³</button>
                        <div class="dropdown-content">
                            <button class="tab-btn" data-src="tools/network-ip.html">IP ä¿¡æ¯</button>
                            <button class="tab-btn" data-src="tools/url.html">URL è§£æ</button>
                            <button class="tab-btn" data-src="tools/network-ping.html">ç½‘ç»œæµ‹è¯•</button>
                            <button class="tab-btn" data-src="tools/network-rdap.html">RDAP WhoisæŸ¥è¯¢</button>
                            <button class="tab-btn" data-src="tools/network-github.html">GitHub APIæœç´¢</button>
                            <button class="tab-btn" data-src="tools/network-epic.html">Epic Free Games</button>
                        </div>
                    </div>
                </nav>

                <button id="theme-btn" title="åˆ‡æ¢ä¸»é¢˜" style="margin-left: 15px; background:rgba(255,255,255,0.1); border:none; color:var(--text-main); cursor:pointer; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; transition:0.2s;" onclick="toggleThemeModal()">
                    â¤
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Drawer -->
    <div id="mobile-drawer" style="position:fixed; top:60px; left:-100%; width:260px; height:calc(100% - 60px); background:var(--bg-deep); border-right:1px solid var(--border); transition:left 0.3s ease; z-index:100; overflow-y:auto; padding:1rem; display:flex; flex-direction:column; gap:0.5rem; box-shadow: 2px 0 10px rgba(0,0,0,0.5);">
        <!-- Content will be injected by JS or cloned -->
    </div>
    <div id="mobile-overlay" onclick="toggleMobileMenu()" style="display:none; position:fixed; top:60px; left:0; width:100%; height:calc(100% - 60px); background:rgba(0,0,0,0.5); z-index:90; backdrop-filter:blur(3px);"></div>
    
    <main style="position:relative;">
        <div id="loading-overlay" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:var(--bg-deep); z-index:50; justify-content:center; align-items:center; flex-direction:column;">
            <div class="spinner" style="width:40px; height:40px; border:4px solid rgba(255,255,255,0.1); border-top:4px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite;"></div>
            <div style="margin-top:10px; color:var(--text-dim); font-size:0.9rem;">Loading...</div>
        </div>
        <style>
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        </style>
        <iframe id="app-frame" src="tools/home.html"></iframe>
    </main>

    <!-- Theme Modal -->
    <div id="theme-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); backdrop-filter:blur(5px); z-index:2000; align-items:center; justify-content:center; opacity:0; transition: opacity 0.3s;">
        <div style="background:var(--bg-deep); width:600px; max-height:85vh; overflow-y:auto; padding:24px; border-radius:var(--radius-lg); border:1px solid var(--border); box-shadow:var(--shadow); transform: scale(0.95); transition: transform 0.3s;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; position:sticky; top:0; background:var(--bg-deep); padding-bottom:10px; border-bottom:1px solid var(--border); z-index:10;">
                <div>
                    <h3 style="margin:0; color:var(--text-main); font-size:1.2rem;">ä¸»é¢˜è®¾ç½®</h3>
                    <div style="font-size:0.8rem; color:var(--text-dim); margin-top:4px;">é€‰æ‹©æ‚¨å–œæ¬¢çš„ç•Œé¢é£æ ¼</div>
                </div>
                <button onclick="toggleThemeModal()" style="background:none; border:none; color:var(--text-dim); font-size:1.5rem; cursor:pointer; padding:5px; border-radius:50%; display:flex; align-items:center; justify-content:center; width:32px; height:32px;">Ã—</button>
            </div>
            
            <div style="margin-bottom:30px;">
                <h4 style="color:var(--text-dim); margin-bottom:15px; font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">é£æ ¼é¢„è®¾ (Presets)</h4>
                <div id="preset-themes-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap:15px;">
                    <!-- Themes will be generated by JS -->
                </div>
            </div>

            <div style="margin-bottom:30px;">
                <h4 style="color:var(--text-dim); margin-bottom:15px; font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">ä»¿çŸ¥åç½‘ç«™é…è‰² (Famous Sites)</h4>
                <div id="famous-themes-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap:15px;">
                    <!-- Themes will be generated by JS -->
                </div>
            </div>

            <div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h4 style="color:var(--text-dim); margin:0; font-size:0.75rem; text-transform:uppercase; letter-spacing:1px; font-weight:600;">è‡ªå®šä¹‰ (Custom)</h4>
                    <div style="display:flex; gap:8px;">
                        <button class="btn btn-sm btn-secondary" onclick="randomizeCustomTheme()" style="font-size:0.75rem; padding:2px 8px;">ğŸ² éšæœº</button>
                        <button id="chaos-btn" class="btn btn-sm btn-secondary" onclick="toggleChaosMode()" style="font-size:0.75rem; padding:2px 8px;">ğŸ”¥ å…¨éšæœº</button>
                        <button id="meltdown-btn" class="btn btn-sm btn-secondary" onclick="toggleMeltdownMode()" style="font-size:0.75rem; padding:2px 8px;">ğŸŒ€ å´©å</button>
                    </div>
                </div>
                <div style="background:var(--bg-panel); padding:20px; border-radius:var(--radius-md); border:1px solid var(--border);">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:0.8rem; color:var(--text-dim);">ä¸»è‰² (Primary)</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="custom-primary" oninput="updateCustomTheme()">
                                <span id="val-primary">#000000</span>
                            </div>
                        </div>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:0.8rem; color:var(--text-dim);">è¾…è‰² (Secondary)</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="custom-secondary" oninput="updateCustomTheme()">
                                <span id="val-secondary">#000000</span>
                            </div>
                        </div>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:0.8rem; color:var(--text-dim);">èƒŒæ™¯ (Background)</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="custom-bg" oninput="updateCustomTheme()">
                                <span id="val-bg">#000000</span>
                            </div>
                        </div>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <label style="font-size:0.8rem; color:var(--text-dim);">æ–‡æœ¬ (Text)</label>
                            <div class="color-input-wrapper">
                                <input type="color" id="custom-text-main" oninput="updateCustomTheme()">
                                <span id="val-text">#000000</span>
                            </div>
                        </div>
                    </div>
                    <!-- Hidden inputs -->
                    <input type="hidden" id="custom-accent">
                    <input type="hidden" id="custom-text-dim">
                </div>
            </div>
        </div>
    </div>

    <style>
        .color-input-wrapper {
            display:flex; 
            align-items:center; 
            background:rgba(0,0,0,0.1); 
            padding:5px 10px; 
            border-radius:var(--radius-sm); 
            border:1px solid var(--border);
            transition: border-color 0.3s;
        }
        .color-input-wrapper:focus-within {
            border-color: var(--primary);
        }
        .color-input-wrapper input[type="color"] {
            background:none; 
            border:none; 
            width:24px; 
            height:24px; 
            padding:0; 
            cursor:pointer;
        }
        .color-input-wrapper span {
            font-size:0.8rem; 
            margin-left:10px; 
            font-family:var(--font-mono); 
            color:var(--text-main);
            opacity: 0.8;
        }
        .theme-card {
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .theme-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border-color: var(--primary);
        }
        .theme-card.active {
            border-color: var(--secondary);
            background: rgba(var(--primary-rgb), 0.1);
            box-shadow: 0 0 0 2px var(--secondary);
        }
        .theme-preview {
            height: 60px;
            border-radius: var(--radius-sm);
            margin-bottom: 5px;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        const frame = document.getElementById('app-frame');
        const loadingOverlay = document.getElementById('loading-overlay');
        
        // Only select tab buttons that have a data-src attribute (exclude dropdown toggles)
        const buttons = document.querySelectorAll('.tab-btn[data-src]');

        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }

        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }

        frame.addEventListener('load', () => {
             hideLoading();
             if (isChaosMode) {
                 randomizeCustomTheme();
             } else if(currentThemeData) {
                 applyThemeVariables(currentThemeData);
             }
             
             // Re-apply meltdown if active (since iframe reloaded)
             if (isMeltdownMode) {
                 setTimeout(applyMeltdownEffect, 100);
             }
        });

        function switchToHome() {
            const homeBtn = document.querySelector('.tab-btn[data-src="tools/home.html"]');
            if (homeBtn) homeBtn.click();
        }

        // Expose switchTab for iframe content (e.g., home.html cards)
        window.switchTab = function(url) {
            const btn = document.querySelector(`.tab-btn[data-src="${url}"]`);
            if(btn) {
                // If the button is inside a dropdown, we might want to ensure the dropdown is visible or just click it
                btn.click();
                // Scroll button into view if needed (less relevant now with dropdowns, but good for Home)
                btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
        };

        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const target = btn.dataset.src;
                if (!target) return;

                // Remove active class from all buttons
                buttons.forEach(b => b.classList.remove('active'));
                
                // Add active class to clicked button
                btn.classList.add('active');

                // Also handle Parent Dropdown Active State if needed
                // Reset all dropdown toggles
                document.querySelectorAll('.dropdown-toggle').forEach(t => t.classList.remove('active'));
                
                // If button is inside a dropdown-content, highlight the parent dropdown toggle
                const dropdownContent = btn.closest('.dropdown-content');
                if (dropdownContent) {
                    const dropdown = dropdownContent.parentElement;
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    if (toggle) toggle.classList.add('active');
                }

                // Avoid reloading if clicking same tab
                if (frame.contentWindow.location.pathname.endsWith(target)) return;
                
                showLoading();
                frame.src = target;
            });
        });

        // Theme Logic
        let currentThemeData = null; 

        const presetThemes = {
            aurora: {
                name: 'æå…‰ (Aurora)',
                desc: 'é»˜è®¤æš—è‰²é£æ ¼ï¼Œéœ“è™¹ç‚¹ç¼€',
                vars: {
                    '--bg-deep': '#0b0f19',
                    '--bg-panel': 'rgba(20, 25, 40, 0.65)',
                    '--bg-header': 'rgba(11, 15, 25, 0.8)',
                    '--primary': '#c084fc',
                    '--secondary': '#2dd4bf',
                    '--accent': '#f472b6',
                    '--text-main': '#f1f5f9',
                    '--text-dim': '#94a3b8',
                    '--bg-image': 'radial-gradient(circle at 10% 20%, rgba(192, 132, 252, 0.12) 0%, transparent 40%), radial-gradient(circle at 90% 80%, rgba(45, 212, 191, 0.12) 0%, transparent 40%)',
                    '--font-main': "'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",
                    '--font-mono': "'JetBrains Mono', Consolas, monospace",
                    '--radius-lg': '16px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 8px 32px rgba(0, 0, 0, 0.4)',
                    '--border': 'rgba(255, 255, 255, 0.1)',
                    '--input-bg': 'rgba(0, 0, 0, 0.3)',
                    '--btn-bg': 'rgba(255, 255, 255, 0.05)',
                    '--btn-hover-bg': 'rgba(255, 255, 255, 0.1)'
                }
            },
            business: {
                name: 'å•†åŠ¡ (Business)',
                desc: 'æ¸…çˆ½è“ç™½ï¼Œä¸“ä¸šç¨³é‡',
                vars: {
                    '--bg-deep': '#f0f2f5',
                    '--bg-panel': '#ffffff',
                    '--bg-header': 'rgba(255, 255, 255, 0.9)',
                    '--primary': '#0052cc',
                    '--secondary': '#172b4d',
                    '--accent': '#0065ff',
                    '--text-main': '#172b4d',
                    '--text-dim': '#5e6c84',
                    '--bg-image': 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif",
                    '--font-mono': "SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace",
                    '--radius-lg': '6px',
                    '--radius-md': '4px',
                    '--radius-sm': '2px',
                    '--shadow': '0 2px 8px rgba(0, 0, 0, 0.1)',
                    '--border': 'rgba(0, 0, 0, 0.1)',
                    '--input-bg': 'rgba(0, 0, 0, 0.05)',
                    '--btn-bg': 'rgba(0, 0, 0, 0.05)',
                    '--btn-hover-bg': 'rgba(0, 0, 0, 0.1)'
                }
            },
            creative: {
                name: 'åˆ›æ„ (Creative)',
                desc: 'æ´»æ³¼é…è‰²ï¼Œåœ†æ¶¦äº²å’Œ',
                vars: {
                    '--bg-deep': '#fff0f5',
                    '--bg-panel': 'rgba(255, 255, 255, 0.9)',
                    '--bg-header': 'rgba(255, 255, 255, 0.8)',
                    '--primary': '#ff6b6b',
                    '--secondary': '#4ecdc4',
                    '--accent': '#ffe66d',
                    '--text-main': '#2f3542',
                    '--text-dim': '#57606f',
                    '--bg-image': 'linear-gradient(120deg, #f6d365 0%, #fda085 100%)',
                    '--font-main': "'Quicksand', 'Comic Sans MS', sans-serif",
                    '--font-mono': "'Fira Code', monospace",
                    '--radius-lg': '24px',
                    '--radius-md': '16px',
                    '--radius-sm': '8px',
                    '--shadow': '0 10px 25px rgba(255, 107, 107, 0.2)',
                    '--border': 'rgba(0, 0, 0, 0.1)',
                    '--input-bg': 'rgba(255, 255, 255, 0.5)',
                    '--btn-bg': 'rgba(255, 107, 107, 0.1)',
                    '--btn-hover-bg': 'rgba(255, 107, 107, 0.2)'
                }
            },
            cyberpunk: {
                name: 'èµ›åš (Cyberpunk)',
                desc: 'é«˜å¯¹æ¯”åº¦ï¼Œç¡¬æœ—çº¿æ¡',
                vars: {
                    '--bg-deep': '#050505',
                    '--bg-panel': 'rgba(20, 10, 30, 0.9)',
                    '--bg-header': 'rgba(5, 5, 5, 0.9)',
                    '--primary': '#ff00ff',
                    '--secondary': '#00ffff',
                    '--accent': '#ffff00',
                    '--text-main': '#e0e0e0',
                    '--text-dim': '#808080',
                    '--bg-image': 'repeating-linear-gradient(0deg, transparent, transparent 1px, #200 1px, #200 2px), linear-gradient(to bottom, #100, #000)',
                    '--font-main': "'Orbitron', 'Segoe UI', sans-serif",
                    '--font-mono': "'Share Tech Mono', monospace",
                    '--radius-lg': '0px',
                    '--radius-md': '0px',
                    '--radius-sm': '0px',
                    '--shadow': '0 0 15px rgba(255, 0, 255, 0.3)',
                    '--border': '#ff00ff',
                    '--input-bg': 'rgba(0, 0, 0, 0.8)',
                    '--btn-bg': 'rgba(255, 0, 255, 0.2)',
                    '--btn-hover-bg': 'rgba(255, 0, 255, 0.4)'
                }
            },
            ocean: {
                name: 'æ·±æµ· (Ocean)',
                desc: 'é™è°§æ·±è“ï¼Œæ²‰æµ¸ä½“éªŒ',
                vars: {
                    '--bg-deep': '#001e2b',
                    '--bg-panel': 'rgba(0, 40, 60, 0.7)',
                    '--bg-header': 'rgba(0, 30, 43, 0.8)',
                    '--primary': '#00a8ff',
                    '--secondary': '#00ffcc',
                    '--accent': '#ffaa00',
                    '--text-main': '#e6f7ff',
                    '--text-dim': '#8ab6d6',
                    '--bg-image': 'linear-gradient(to top, #001e2b 0%, #00334e 100%)',
                    '--font-main': "'Inter', sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '12px',
                    '--radius-md': '6px',
                    '--radius-sm': '3px',
                    '--shadow': '0 8px 32px rgba(0, 20, 40, 0.5)',
                    '--border': 'rgba(0, 168, 255, 0.2)',
                    '--input-bg': 'rgba(0, 0, 0, 0.3)',
                    '--btn-bg': 'rgba(0, 168, 255, 0.1)',
                    '--btn-hover-bg': 'rgba(0, 168, 255, 0.2)'
                }
            },
            forest: {
                name: 'æ£®æ— (Forest)',
                desc: 'è‡ªç„¶æš—ç»¿ï¼Œèˆ’é€‚æŠ¤çœ¼',
                vars: {
                    '--bg-deep': '#0a1a0a',
                    '--bg-panel': 'rgba(20, 40, 20, 0.7)',
                    '--bg-header': 'rgba(10, 26, 10, 0.8)',
                    '--primary': '#4ade80',
                    '--secondary': '#facc15',
                    '--accent': '#f87171',
                    '--text-main': '#f0fdf4',
                    '--text-dim': '#86efac',
                    '--bg-image': 'radial-gradient(circle at 50% 50%, #1a2e1a 0%, #0a1a0a 100%)',
                    '--font-main': "'Inter', sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '16px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 8px 24px rgba(0, 20, 0, 0.5)',
                    '--border': 'rgba(74, 222, 128, 0.2)',
                    '--input-bg': 'rgba(0, 0, 0, 0.3)',
                    '--btn-bg': 'rgba(74, 222, 128, 0.1)',
                    '--btn-hover-bg': 'rgba(74, 222, 128, 0.2)'
                }
            },
            monochrome: {
                name: 'é»‘ç™½ (Mono)',
                desc: 'æè‡´ç®€çº¦ï¼Œæ— è‰²å¹²æ‰°',
                vars: {
                    '--bg-deep': '#000000',
                    '--bg-panel': 'rgba(25, 25, 25, 0.9)',
                    '--bg-header': 'rgba(0, 0, 0, 0.9)',
                    '--primary': '#ffffff',
                    '--secondary': '#888888',
                    '--accent': '#aaaaaa',
                    '--text-main': '#ffffff',
                    '--text-dim': '#666666',
                    '--bg-image': 'linear-gradient(45deg, #111 25%, transparent 25%, transparent 75%, #111 75%, #111), linear-gradient(45deg, #111 25%, transparent 25%, transparent 75%, #111 75%, #111)',
                    '--font-main': "'Courier New', monospace",
                    '--font-mono': "'Courier New', monospace",
                    '--radius-lg': '0px',
                    '--radius-md': '0px',
                    '--radius-sm': '0px',
                    '--shadow': 'none',
                    '--border': '#333333',
                    '--input-bg': '#111111',
                    '--btn-bg': '#222222',
                    '--btn-hover-bg': '#333333'
                }
            },
            sunset: {
                name: 'æ—¥è½ (Sunset)',
                desc: 'æ¸©æš–æ¸å˜ï¼ŒæŸ”å’Œèˆ’é€‚',
                vars: {
                    '--bg-deep': '#2d1b2e',
                    '--bg-panel': 'rgba(69, 39, 60, 0.7)',
                    '--bg-header': 'rgba(45, 27, 46, 0.9)',
                    '--primary': '#ff9a9e',
                    '--secondary': '#fad0c4',
                    '--accent': '#ffecd2',
                    '--text-main': '#fff1eb',
                    '--text-dim': '#d4a5a5',
                    '--bg-image': 'linear-gradient(to top, #30cfd0 0%, #330867 100%)',
                    '--font-main': "'Inter', sans-serif",
                    '--font-mono': "'Fira Code', monospace",
                    '--radius-lg': '12px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 8px 32px rgba(0, 0, 0, 0.3)',
                    '--border': 'rgba(255, 154, 158, 0.2)',
                    '--input-bg': 'rgba(0, 0, 0, 0.2)',
                    '--btn-bg': 'rgba(255, 154, 158, 0.1)',
                    '--btn-hover-bg': 'rgba(255, 154, 158, 0.2)'
                }
            },
            mint: {
                name: 'è–„è· (Mint)',
                desc: 'æ¸…æ–°æ·¡é›…ï¼Œæ¸…çˆ½ä½“éªŒ',
                vars: {
                    '--bg-deep': '#e0f2f1',
                    '--bg-panel': 'rgba(255, 255, 255, 0.85)',
                    '--bg-header': 'rgba(224, 242, 241, 0.9)',
                    '--primary': '#009688',
                    '--secondary': '#4db6ac',
                    '--accent': '#80cbc4',
                    '--text-main': '#004d40',
                    '--text-dim': '#00796b',
                    '--bg-image': 'radial-gradient(circle at 10% 20%, rgba(128, 203, 196, 0.2) 0%, transparent 50%), radial-gradient(circle at 90% 80%, rgba(38, 166, 154, 0.2) 0%, transparent 50%)',
                    '--font-main': "'Inter', sans-serif",
                    '--font-mono': "'JetBrains Mono', monospace",
                    '--radius-lg': '16px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 4px 12px rgba(0, 150, 136, 0.15)',
                    '--border': 'rgba(0, 150, 136, 0.2)',
                    '--input-bg': 'rgba(255, 255, 255, 0.6)',
                    '--btn-bg': 'rgba(0, 150, 136, 0.1)',
                    '--btn-hover-bg': 'rgba(0, 150, 136, 0.2)'
                }
            }
        };

        const famousThemes = {
            github: {
                name: 'GitHub Dark',
                desc: 'æ²‰æµ¸å¼ä»£ç ä½“éªŒ',
                vars: {
                    '--bg-deep': '#0d1117',
                    '--bg-panel': '#161b22',
                    '--bg-header': 'rgba(22, 27, 34, 0.95)',
                    '--primary': '#58a6ff',
                    '--secondary': '#238636',
                    '--accent': '#f85149',
                    '--text-main': '#c9d1d9',
                    '--text-dim': '#8b949e',
                    '--bg-image': 'none',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif",
                    '--font-mono': "ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace",
                    '--radius-lg': '6px',
                    '--radius-md': '6px',
                    '--radius-sm': '6px',
                    '--shadow': '0 0 15px rgba(0,0,0,0.5)',
                    '--border': '#30363d',
                    '--input-bg': '#0d1117',
                    '--btn-bg': '#21262d',
                    '--btn-hover-bg': '#30363d'
                }
            },
            discord: {
                name: 'Discord',
                desc: 'æ¸¸æˆç©å®¶é¦–é€‰',
                vars: {
                    '--bg-deep': '#36393f',
                    '--bg-panel': '#2f3136',
                    '--bg-header': '#202225',
                    '--primary': '#5865f2',
                    '--secondary': '#3ba55c',
                    '--accent': '#ed4245',
                    '--text-main': '#dcddde',
                    '--text-dim': '#72767d',
                    '--bg-image': 'none',
                    '--font-main': "'gg sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "Consolas, monospace",
                    '--radius-lg': '8px',
                    '--radius-md': '4px',
                    '--radius-sm': '3px',
                    '--shadow': '0 2px 10px rgba(0,0,0,0.2)',
                    '--border': '#202225',
                    '--input-bg': '#40444b',
                    '--btn-bg': '#4f545c',
                    '--btn-hover-bg': '#686d73'
                }
            },
            youtube: {
                name: 'YouTube Dark',
                desc: 'ä¸“æ³¨è§†é¢‘å†…å®¹',
                vars: {
                    '--bg-deep': '#0f0f0f',
                    '--bg-panel': '#272727',
                    '--bg-header': 'rgba(15, 15, 15, 0.98)',
                    '--primary': '#ff0000',
                    '--secondary': '#3ea6ff',
                    '--accent': '#ff0000',
                    '--text-main': '#f1f1f1',
                    '--text-dim': '#aaaaaa',
                    '--bg-image': 'none',
                    '--font-main': "Roboto, Arial, sans-serif",
                    '--font-mono': "Roboto Mono, monospace",
                    '--radius-lg': '12px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 4px 10px rgba(0,0,0,0.3)',
                    '--border': 'rgba(255,255,255,0.1)',
                    '--input-bg': '#121212',
                    '--btn-bg': 'rgba(255,255,255,0.1)',
                    '--btn-hover-bg': 'rgba(255,255,255,0.2)'
                }
            },
            vscode: {
                name: 'VS Code Dark',
                desc: 'å¼€å‘è€…æœ€çˆ±',
                vars: {
                    '--bg-deep': '#1e1e1e',
                    '--bg-panel': '#252526',
                    '--bg-header': '#333333',
                    '--primary': '#007acc',
                    '--secondary': '#0e639c',
                    '--accent': '#f14c4c',
                    '--text-main': '#cccccc',
                    '--text-dim': '#858585',
                    '--bg-image': 'none',
                    '--font-main': "'Segoe WPC', 'Segoe UI', sans-serif",
                    '--font-mono': "Consolas, 'Courier New', monospace",
                    '--radius-lg': '0px',
                    '--radius-md': '0px',
                    '--radius-sm': '0px',
                    '--shadow': '0 2px 8px rgba(0,0,0,0.3)',
                    '--border': '#3e3e42',
                    '--input-bg': '#3c3c3c',
                    '--btn-bg': '#3c3c3c',
                    '--btn-hover-bg': '#4a4a4a'
                }
            },
            bilibili: {
                name: 'Bilibili Pink',
                desc: 'å¹²æ¯ ( â€¢Ì€ Ï‰ â€¢Ì )y',
                vars: {
                    '--bg-deep': '#f6f7f8',
                    '--bg-panel': '#ffffff',
                    '--bg-header': '#ffffff',
                    '--primary': '#fb7299',
                    '--secondary': '#00a1d6',
                    '--accent': '#fb7299',
                    '--text-main': '#18191c',
                    '--text-dim': '#9499a0',
                    '--bg-image': 'none',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '8px',
                    '--radius-md': '6px',
                    '--radius-sm': '4px',
                    '--shadow': '0 2px 10px rgba(0,0,0,0.05)',
                    '--border': '#e3e5e7',
                    '--input-bg': '#f1f2f3',
                    '--btn-bg': '#f6f7f8',
                    '--btn-hover-bg': '#e3e5e7'
                }
            },
            pornhub: {
                name: 'PH Dark',
                desc: 'é»‘æ©™ç»å…¸ï¼Œå¤œé—´é¦–é€‰',
                vars: {
                    '--bg-deep': '#000000',
                    '--bg-panel': '#1b1b1b',
                    '--bg-header': '#000000',
                    '--primary': '#ff9900',
                    '--secondary': '#ffffff',
                    '--accent': '#ff9900',
                    '--text-main': '#ffffff',
                    '--text-dim': '#999999',
                    '--bg-image': 'none',
                    '--font-main': "Arial, Helvetica, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '4px',
                    '--radius-md': '3px',
                    '--radius-sm': '2px',
                    '--shadow': '0 2px 5px rgba(0,0,0,0.5)',
                    '--border': '#333333',
                    '--input-bg': '#333333',
                    '--btn-bg': '#333333',
                    '--btn-hover-bg': '#444444'
                }
            },
            xvideos: {
                name: 'XV Red',
                desc: 'é»‘çº¢é…è‰²ï¼Œçƒ­æƒ…å¥”æ”¾',
                vars: {
                    '--bg-deep': '#141414',
                    '--bg-panel': '#232323',
                    '--bg-header': '#141414',
                    '--primary': '#de2b1e',
                    '--secondary': '#000000',
                    '--accent': '#de2b1e',
                    '--text-main': '#f2f2f2',
                    '--text-dim': '#888888',
                    '--bg-image': 'none',
                    '--font-main': "Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '4px',
                    '--radius-md': '2px',
                    '--radius-sm': '0px',
                    '--shadow': '0 1px 3px rgba(0,0,0,0.5)',
                    '--border': '#2f2f2f',
                    '--input-bg': '#000000',
                    '--btn-bg': '#2f2f2f',
                    '--btn-hover-bg': '#3f3f3f'
                }
            },
            pixiv: {
                name: 'Pixiv Blue',
                desc: 'äºŒæ¬¡å…ƒæ’ç”»é£æ ¼',
                vars: {
                    '--bg-deep': '#f5f5f5',
                    '--bg-panel': '#ffffff',
                    '--bg-header': '#ffffff',
                    '--primary': '#0096fa',
                    '--secondary': '#333333',
                    '--accent': '#ff5e5e',
                    '--text-main': '#333333',
                    '--text-dim': '#adadad',
                    '--bg-image': 'none',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '16px',
                    '--radius-md': '8px',
                    '--radius-sm': '4px',
                    '--shadow': '0 2px 10px rgba(0,0,0,0.05)',
                    '--border': '#e0e0e0',
                    '--input-bg': '#f5f5f5',
                    '--btn-bg': '#f5f5f5',
                    '--btn-hover-bg': '#e0e0e0'
                }
            },
            ehentai: {
                name: 'EH Panda',
                desc: 'Sad Panda ç»å…¸ç°',
                vars: {
                    '--bg-deep': '#34353b',
                    '--bg-panel': '#4f535b',
                    '--bg-header': '#34353b',
                    '--primary': '#dddddd',
                    '--secondary': '#5c0d12',
                    '--accent': '#ff0000',
                    '--text-main': '#dddddd',
                    '--text-dim': '#b3b3b3',
                    '--bg-image': 'none',
                    '--font-main': "Arial, Helvetica, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '0px',
                    '--radius-md': '0px',
                    '--radius-sm': '0px',
                    '--shadow': '0 1px 2px rgba(0,0,0,0.5)',
                    '--border': '#5c0d12',
                    '--input-bg': '#34353b',
                    '--btn-bg': '#34353b',
                    '--btn-hover-bg': '#43464e'
                }
            },
            twitter: {
                name: 'X (Twitter)',
                desc: 'æç®€é»‘ï¼Œä¿¡æ¯æµ',
                vars: {
                    '--bg-deep': '#000000',
                    '--bg-panel': '#16181c',
                    '--bg-header': 'rgba(0, 0, 0, 0.85)',
                    '--primary': '#1d9bf0',
                    '--secondary': '#eff3f4',
                    '--accent': '#1d9bf0',
                    '--text-main': '#e7e9ea',
                    '--text-dim': '#71767b',
                    '--bg-image': 'none',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '16px',
                    '--radius-md': '16px',
                    '--radius-sm': '8px',
                    '--shadow': '0 0 10px rgba(255,255,255,0.05)',
                    '--border': '#2f3336',
                    '--input-bg': '#202327',
                    '--btn-bg': '#eff3f41a',
                    '--btn-hover-bg': '#eff3f42a'
                }
            },
            reddit: {
                name: 'Reddit Dark',
                desc: 'ç¤¾åŒºè®¨è®ºï¼Œæ©™è‰²æ´»åŠ›',
                vars: {
                    '--bg-deep': '#0b1416',
                    '--bg-panel': '#1a282d',
                    '--bg-header': '#1a282d',
                    '--primary': '#ff4500',
                    '--secondary': '#0079d3',
                    '--accent': '#ff4500',
                    '--text-main': '#d7dadc',
                    '--text-dim': '#818384',
                    '--bg-image': 'none',
                    '--font-main': "'IBM Plex Sans', sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '4px',
                    '--radius-md': '4px',
                    '--radius-sm': '2px',
                    '--shadow': '0 2px 4px rgba(0,0,0,0.2)',
                    '--border': '#343536',
                    '--input-bg': '#272729',
                    '--btn-bg': '#272729',
                    '--btn-hover-bg': '#343536'
                }
            },
            spotify: {
                name: 'Spotify',
                desc: 'éŸ³ä¹å¾‹åŠ¨ï¼Œç»å…¸é»‘ç»¿',
                vars: {
                    '--bg-deep': '#121212',
                    '--bg-panel': '#181818',
                    '--bg-header': '#000000',
                    '--primary': '#1db954',
                    '--secondary': '#ffffff',
                    '--accent': '#1ed760',
                    '--text-main': '#ffffff',
                    '--text-dim': '#b3b3b3',
                    '--bg-image': 'linear-gradient(to bottom, #121212, #121212)',
                    '--font-main': "'Circular', 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '8px',
                    '--radius-md': '4px',
                    '--radius-sm': '2px',
                    '--shadow': '0 4px 60px rgba(0,0,0,0.5)',
                    '--border': '#282828',
                    '--input-bg': '#2a2a2a',
                    '--btn-bg': '#2a2a2a',
                    '--btn-hover-bg': '#3e3e3e'
                }
            },
            netflix: {
                name: 'Netflix',
                desc: 'å®¶åº­å½±é™¢ï¼Œçº¢é»‘è§†è§‰',
                vars: {
                    '--bg-deep': '#141414',
                    '--bg-panel': '#181818',
                    '--bg-header': 'rgba(20, 20, 20, 0.9)',
                    '--primary': '#e50914',
                    '--secondary': '#ffffff',
                    '--accent': '#b20710',
                    '--text-main': '#ffffff',
                    '--text-dim': '#808080',
                    '--bg-image': 'none',
                    '--font-main': "'Netflix Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '4px',
                    '--radius-md': '2px',
                    '--radius-sm': '0px',
                    '--shadow': '0 2px 10px rgba(0,0,0,0.7)',
                    '--border': '#333333',
                    '--input-bg': '#333333',
                    '--btn-bg': 'rgba(255,255,255,0.1)',
                    '--btn-hover-bg': 'rgba(255,255,255,0.2)'
                }
            },
            twitch: {
                name: 'Twitch',
                desc: 'ç›´æ’­äº’åŠ¨ï¼ŒåŸºä½¬ç´«',
                vars: {
                    '--bg-deep': '#0e0e10',
                    '--bg-panel': '#18181b',
                    '--bg-header': '#18181b',
                    '--primary': '#9146ff',
                    '--secondary': '#bf94ff',
                    '--accent': '#9146ff',
                    '--text-main': '#efeff1',
                    '--text-dim': '#adadb8',
                    '--bg-image': 'none',
                    '--font-main': "'Inter', 'Roobert', 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '6px',
                    '--radius-md': '4px',
                    '--radius-sm': '2px',
                    '--shadow': '0 1px 2px rgba(0,0,0,0.15)',
                    '--border': '#303032',
                    '--input-bg': '#303032',
                    '--btn-bg': '#303032',
                    '--btn-hover-bg': '#464649'
                }
            },
            steam: {
                name: 'Steam',
                desc: 'ç¡¬æ ¸æ¸¸æˆï¼Œæ·±è“å·¥ä¸š',
                vars: {
                    '--bg-deep': '#1b2838',
                    '--bg-panel': 'rgba(23, 26, 33, 0.8)',
                    '--bg-header': '#171a21',
                    '--primary': '#66c0f4',
                    '--secondary': '#c7d5e0',
                    '--accent': '#a4d007',
                    '--text-main': '#c7d5e0',
                    '--text-dim': '#626366',
                    '--bg-image': 'linear-gradient(to bottom, #171a21 0%, #1b2838 100%)',
                    '--font-main': "'Motiva Sans', Sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '2px',
                    '--radius-md': '2px',
                    '--radius-sm': '0px',
                    '--shadow': '0 0 12px rgba(0,0,0,0.5)',
                    '--border': '#2a475e',
                    '--input-bg': '#0f1216',
                    '--btn-bg': 'linear-gradient( to bottom, #47bfff 5%, #1a44c2 60%)',
                    '--btn-hover-bg': 'linear-gradient( to bottom, #5bc6ff 5%, #1d4ecf 60%)'
                }
            },
            stackoverflow: {
                name: 'Stack Overflow',
                desc: 'çŸ¥è¯†é—®ç­”ï¼Œæ¸…çˆ½ç™½æ©™',
                vars: {
                    '--bg-deep': '#f1f2f3',
                    '--bg-panel': '#ffffff',
                    '--bg-header': '#f8f9f9',
                    '--primary': '#f48024',
                    '--secondary': '#0074cc',
                    '--accent': '#f48024',
                    '--text-main': '#232629',
                    '--text-dim': '#6a737c',
                    '--bg-image': 'none',
                    '--font-main': "-apple-system, BlinkMacSystemFont, 'Segoe UI Adjusted', 'Segoe UI', 'Liberation Sans', sans-serif",
                    '--font-mono': "ui-monospace, 'Cascadia Mono', 'Segoe UI Mono', 'Liberation Mono', Menlo, Monaco, Consolas, monospace",
                    '--radius-lg': '3px',
                    '--radius-md': '3px',
                    '--radius-sm': '2px',
                    '--shadow': '0 1px 4px rgba(0,0,0,0.05)',
                    '--border': '#babfc4',
                    '--input-bg': '#ffffff',
                    '--btn-bg': '#e1ecf4',
                    '--btn-hover-bg': '#b3d3ea'
                }
            },
            telegram: {
                name: 'Telegram',
                desc: 'å®‰å…¨é€šè®¯ï¼Œç»å…¸è“',
                vars: {
                    '--bg-deep': '#17212b',
                    '--bg-panel': '#242f3d',
                    '--bg-header': '#17212b',
                    '--primary': '#5288c1',
                    '--secondary': '#6499cc',
                    '--accent': '#2f6ea5',
                    '--text-main': '#f5f5f5',
                    '--text-dim': '#7f91a4',
                    '--bg-image': 'none',
                    '--font-main': "Roboto, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '10px',
                    '--radius-md': '6px',
                    '--radius-sm': '4px',
                    '--shadow': '0 1px 2px rgba(0,0,0,0.15)',
                    '--border': '#13181d',
                    '--input-bg': '#17212b',
                    '--btn-bg': '#2b5278',
                    '--btn-hover-bg': '#336290'
                }
            },
            chatgpt: {
                name: 'ChatGPT',
                desc: 'AI åŠ©æ‰‹ï¼Œç°ç»¿æç®€',
                vars: {
                    '--bg-deep': '#343541',
                    '--bg-panel': '#444654',
                    '--bg-header': '#343541',
                    '--primary': '#10a37f',
                    '--secondary': '#c5c5d2',
                    '--accent': '#1a7f64',
                    '--text-main': '#ececf1',
                    '--text-dim': '#c5c5d2',
                    '--bg-image': 'none',
                    '--font-main': "'SÃ¶hne', 'Helvetica Neue', Helvetica, Arial, sans-serif",
                    '--font-mono': "monospace",
                    '--radius-lg': '6px',
                    '--radius-md': '4px',
                    '--radius-sm': '2px',
                    '--shadow': '0 0 15px rgba(0,0,0,0.1)',
                    '--border': 'rgba(255,255,255,0.1)',
                    '--input-bg': '#40414f',
                    '--btn-bg': '#40414f',
                    '--btn-hover-bg': '#505263'
                }
            }
        };

        const allThemes = { ...presetThemes, ...famousThemes };

        function renderThemeList() {
            const renderGrid = (containerId, themesObj) => {
                const grid = document.getElementById(containerId);
                if(!grid) return;
                grid.innerHTML = '';

                Object.entries(themesObj).forEach(([key, theme]) => {
                    const btn = document.createElement('div');
                    btn.className = 'theme-card';
                    btn.onclick = () => setTheme(key);
                    
                    // Create preview
                    const preview = document.createElement('div');
                    preview.className = 'theme-preview';
                    preview.style.background = theme.vars['--bg-deep'];
                    preview.style.backgroundImage = theme.vars['--bg-image'];
                    
                    // Add a small "window" inside preview to show panel color
                    const panel = document.createElement('div');
                    panel.style.position = 'absolute';
                    panel.style.bottom = '10px';
                    panel.style.right = '10px';
                    panel.style.width = '60%';
                    panel.style.height = '60%';
                    panel.style.background = theme.vars['--bg-panel'];
                    panel.style.borderRadius = theme.vars['--radius-sm'];
                    panel.style.border = `1px solid ${theme.vars['--border'] || 'rgba(255,255,255,0.1)'}`;
                    preview.appendChild(panel);

                    // Add primary color dot
                    const dot = document.createElement('div');
                    dot.style.position = 'absolute';
                    dot.style.top = '10px';
                    dot.style.left = '10px';
                    dot.style.width = '12px';
                    dot.style.height = '12px';
                    dot.style.borderRadius = '50%';
                    dot.style.background = theme.vars['--primary'];
                    preview.appendChild(dot);

                    const info = document.createElement('div');
                    info.innerHTML = `
                        <div style="font-weight:bold; font-size:0.9rem; color:var(--text-main)">${theme.name.split(' ')[0]}</div>
                        <div style="font-size:0.7rem; color:var(--text-dim); margin-top:2px;">${theme.desc}</div>
                    `;

                    btn.appendChild(preview);
                    btn.appendChild(info);
                    grid.appendChild(btn);
                });
            };

            renderGrid('preset-themes-grid', presetThemes);
            renderGrid('famous-themes-grid', famousThemes);
        }

        function toggleThemeModal() {
            const modal = document.getElementById('theme-modal');
            if (modal.style.display === 'flex') {
                modal.style.opacity = '0';
                modal.querySelector('div').style.transform = 'scale(0.95)';
                setTimeout(() => modal.style.display = 'none', 300);
            } else {
                renderThemeList(); // Re-render to ensure current theme highlight if I add that logic
                modal.style.display = 'flex';
                // Trigger reflow
                modal.offsetHeight; 
                modal.style.opacity = '1';
                modal.querySelector('div').style.transform = 'scale(1)';
            }
        }

        // Close modal when clicking outside
        document.getElementById('theme-modal').addEventListener('click', function(e) {
            if (e.target === this) toggleThemeModal();
        });

        function setTheme(name) {
            const theme = allThemes[name];
            if(!theme) return;
            
            applyThemeVariables(theme.vars);
            syncCustomInputs(theme.vars);
            currentThemeData = theme.vars;
            
            // Highlight selected
            document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
            // This is tricky because we regenerate list. But simple enough:
            // renderThemeList can check currentThemeData
        }

        function syncCustomInputs(vars) {
            const setVal = (id, val) => {
                const el = document.getElementById(id);
                const disp = document.getElementById('val-' + id.split('-')[1]);
                if(el && val && val.startsWith('#')) {
                    el.value = val;
                    if(disp) disp.innerText = val;
                }
            };

            setVal('custom-primary', vars['--primary']);
            setVal('custom-secondary', vars['--secondary']);
            setVal('custom-bg', vars['--bg-deep']);
            setVal('custom-text-main', vars['--text-main']);
        }

        function updateCustomTheme() {
            const getVal = (id) => {
                const val = document.getElementById(id).value;
                document.getElementById('val-' + id.split('-')[1]).innerText = val;
                return val;
            };
            
            const bgDeep = getVal('custom-bg');
            const primary = getVal('custom-primary');
            const textMain = getVal('custom-text-main');
            const isLightBg = getContrastColor(bgDeep) === '#000000';

            const theme = {
                '--primary': primary,
                '--secondary': getVal('custom-secondary'),
                '--accent': primary, // Link accent to primary for simple custom
                '--bg-deep': bgDeep,
                '--text-main': textMain,
                '--text-dim': adjustColorOpacity(textMain, 0.6),
                
                // Defaults for custom
                '--bg-panel': isLightBg ? '#ffffff' : 'rgba(20, 25, 40, 0.65)',
                '--bg-header': isLightBg ? 'rgba(255, 255, 255, 0.9)' : 'rgba(11, 15, 25, 0.8)',
                '--bg-image': 'none',
                '--font-main': "'Inter', sans-serif",
                '--font-mono': "'JetBrains Mono', monospace",
                '--radius-lg': '8px',
                '--radius-md': '4px',
                '--radius-sm': '2px',
                '--shadow': isLightBg ? '0 4px 12px rgba(0,0,0,0.1)' : '0 8px 32px rgba(0, 0, 0, 0.4)',
                '--border': isLightBg ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)',
                '--input-bg': isLightBg ? 'rgba(0, 0, 0, 0.05)' : 'rgba(0, 0, 0, 0.3)',
                '--btn-bg': isLightBg ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.05)',
                '--btn-hover-bg': isLightBg ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)'
            };
            
            applyThemeVariables(theme);
            currentThemeData = theme;
        }

        // Helper to adjust color (simplified)
        function adjustColorOpacity(hex, opacity, invert = false) {
            // Very basic implementation, just returns hex if complex
            return hex; 
        }

        // --- Random / Chaos Mode ---
        let isChaosMode = false;

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function randomizeCustomTheme() {
            const primary = getRandomColor();
            const secondary = getRandomColor();
            const bg = getRandomColor();
            // Ensure text contrasts with bg
            const isDark = getContrastColor(bg) === '#ffffff';
            const text = isDark ? '#f1f5f9' : '#1a1f2e'; // Simple default text based on bg

            document.getElementById('custom-primary').value = primary;
            document.getElementById('custom-secondary').value = secondary;
            document.getElementById('custom-bg').value = bg;
            document.getElementById('custom-text-main').value = text;
            
            // Trigger update
            updateCustomTheme();
        }

        function toggleChaosMode() {
            isChaosMode = !isChaosMode;
            const btn = document.getElementById('chaos-btn');
            if (isChaosMode) {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary'); // Or some active style
                btn.innerText = 'ğŸ”¥ å…¨éšæœº (ON)';
                // Immediately randomize
                randomizeCustomTheme();
            } else {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
                btn.innerText = 'ğŸ”¥ å…¨éšæœº';
            }
        }

        // --- Meltdown Mode (Component-level Randomization) ---
        let isMeltdownMode = false;

        function toggleMeltdownMode() {
            isMeltdownMode = !isMeltdownMode;
            const btn = document.getElementById('meltdown-btn');
            
            if (isMeltdownMode) {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-danger'); // Use red for danger/meltdown
                btn.innerText = 'ğŸŒ€ å´©å (ON)';
                app.showToast('å´©åæ¨¡å¼å·²å¼€å¯ï¼šè­¦å‘Šï¼é«˜èƒ½ååº”ï¼', 'warning');
                applyMeltdownEffect();
            } else {
                btn.classList.remove('btn-danger');
                btn.classList.add('btn-secondary');
                btn.innerText = 'ğŸŒ€ å´©å';
                removeMeltdownEffect();
            }
        }

        function applyMeltdownEffect() {
            if (!frame || !frame.contentWindow) return;
            
            const doc = frame.contentWindow.document;
            let styleEl = doc.getElementById('meltdown-style');
            
            if (!styleEl) {
                styleEl = doc.createElement('style');
                styleEl.id = 'meltdown-style';
                doc.head.appendChild(styleEl);
            }

            // Generate crazy CSS
            let css = '';
            const selectors = ['div', 'span', 'button', 'input', '.panel', '.btn', '.card', 'label', 'h1', 'h2', 'h3', 'h4'];
            const props = ['color', 'background-color', 'border-color'];
            
            // We use :nth-child to target elements pseudo-randomly without JS iteration
            // Generate 50 rules
            for (let i = 1; i <= 50; i++) {
                const color = getRandomColor();
                const bg = getRandomColor();
                const border = getRandomColor();
                
                // Randomly target children
                // e.g. *:nth-child(50n + 1)
                css += `*:nth-child(50n + ${i}) { 
                    --primary: ${color} !important; 
                    --secondary: ${bg} !important;
                    --bg-panel: ${bg}80 !important;
                    --text-main: ${getContrastColor(bg)} !important;
                    border-color: ${border} !important;
                }\n`;
                
                // Specific component overrides for maximum chaos
                css += `.btn:nth-child(20n + ${i}) { background-color: ${bg} !important; color: ${getContrastColor(bg)} !important; }\n`;
                css += `.panel:nth-child(10n + ${i}) { background-color: ${color}20 !important; }\n`;
            }

            styleEl.textContent = css;
        }

        function removeMeltdownEffect() {
            if (!frame || !frame.contentWindow) return;
            const styleEl = frame.contentWindow.document.getElementById('meltdown-style');
            if (styleEl) styleEl.remove();
        }

        function getContrastColor(hex) {
            if (!hex || !hex.startsWith('#')) return '#ffffff';
            const r = parseInt(hex.substr(1, 2), 16);
            const g = parseInt(hex.substr(3, 2), 16);
            const b = parseInt(hex.substr(5, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? '#000000' : '#ffffff';
        }

        function applyThemeVariables(theme) {
            const root = document.documentElement;
            
            // Calculate contrast colors
            if(theme['--primary']) {
                theme['--primary-contrast'] = getContrastColor(theme['--primary']);
            }
            // Auto-calculate text visibility for light/dark backgrounds if not explicitly set
            // (Optional, but good for custom themes)
            
            // Optimization: Request Animation Frame to batch reflows
            requestAnimationFrame(() => {
                for (const [key, value] of Object.entries(theme)) {
                    root.style.setProperty(key, value);
                }
                if(frame && frame.contentWindow) {
                    const frameRoot = frame.contentWindow.document.documentElement;
                    try {
                        for (const [key, value] of Object.entries(theme)) {
                            frameRoot.style.setProperty(key, value);
                        }
                        
                        // Propagate to nested iframes (Level 2)
                        // Try to find iframes inside the current frame
                        const nestedFrames = frame.contentWindow.document.querySelectorAll('iframe');
                        nestedFrames.forEach(nestedFrame => {
                            try {
                                const nestedRoot = nestedFrame.contentWindow.document.documentElement;
                                for (const [key, value] of Object.entries(theme)) {
                                    nestedRoot.style.setProperty(key, value);
                                }
                                
                                // Propagate to Level 3 (e.g. image-fun -> image-phantom)
                                const deepFrames = nestedFrame.contentWindow.document.querySelectorAll('iframe');
                                deepFrames.forEach(deepFrame => {
                                    try {
                                        const deepRoot = deepFrame.contentWindow.document.documentElement;
                                        for (const [key, value] of Object.entries(theme)) {
                                            deepRoot.style.setProperty(key, value);
                                        }
                                    } catch(e) {}
                                });
                            } catch(e) {}
                        });
                        
                    } catch(e) {}
                }
            });
        }

        // Initialize with Aurora but don't persist
        // Pre-fill inputs with default aurora values
        syncCustomInputs(presetThemes['aurora']);
        
        // Also listen for iframe load to re-apply theme
        // (Handled above in frame.load)
        // frame.addEventListener('load', () => {
        //      if(currentThemeData) {
        //          applyThemeVariables(currentThemeData);
        //      }
        // });

        // Mobile Menu Logic
        const mobileDrawer = document.getElementById('mobile-drawer');
        const mobileOverlay = document.getElementById('mobile-overlay');
        let isMobileMenuOpen = false;

        function toggleMobileMenu() {
            isMobileMenuOpen = !isMobileMenuOpen;
            if (isMobileMenuOpen) {
                mobileDrawer.style.left = '0';
                mobileOverlay.style.display = 'block';
                // Lazy init
                if (mobileDrawer.children.length === 0 || mobileDrawer.innerHTML.trim() === '<!-- Content will be injected by JS or cloned -->') {
                    initMobileMenu();
                }
            } else {
                mobileDrawer.style.left = '-100%';
                mobileOverlay.style.display = 'none';
            }
        }

        function initMobileMenu() {
            mobileDrawer.innerHTML = ''; // Clear placeholder
            
            // Clone Back/Home Button (The one with â†©â¤â†©)
            const backBtn = document.querySelector('#main-nav > .btn');
            if(backBtn) {
                const backClone = backBtn.cloneNode(true);
                // Ensure it looks good in drawer (full width)
                backClone.style.width = '100%';
                backClone.style.marginBottom = '10px';
                mobileDrawer.appendChild(backClone);
            }
            
            // Clone Home Button
            const homeBtn = document.querySelector('.tab-btn[data-src="tools/home.html"]').cloneNode(true);
            attachMobileClick(homeBtn);
            mobileDrawer.appendChild(homeBtn);

            // Clone Dropdowns as Groups
            document.querySelectorAll('.dropdown').forEach(dd => {
                const title = dd.querySelector('.dropdown-toggle').innerText;
                const groupTitle = document.createElement('div');
                groupTitle.className = 'group-title';
                groupTitle.innerText = title;
                // Inline styles for group title
                groupTitle.style.marginTop = '15px';
                groupTitle.style.marginBottom = '8px';
                groupTitle.style.color = 'var(--primary)';
                groupTitle.style.fontWeight = 'bold';
                groupTitle.style.fontSize = '1.1rem';
                mobileDrawer.appendChild(groupTitle);

                const content = dd.querySelector('.dropdown-content');
                if (content) {
                    Array.from(content.children).forEach(child => {
                        if (child.classList.contains('tab-btn')) {
                            const clone = child.cloneNode(true);
                            clone.style.width = '100%'; // Ensure full width
                            clone.style.justifyContent = 'flex-start';
                            clone.style.padding = '10px';
                            attachMobileClick(clone);
                            mobileDrawer.appendChild(clone);
                        } else if (child.classList.contains('dropdown-header')) {
                            const header = document.createElement('div');
                            header.style.padding = '12px 0 4px 5px';
                            header.style.fontSize = '0.8rem';
                            header.style.color = 'var(--text-dim)';
                            header.style.fontWeight = '600';
                            header.style.textTransform = 'uppercase';
                            header.style.letterSpacing = '1px';
                            header.innerText = child.innerText;
                            mobileDrawer.appendChild(header);
                        }
                        // We skip dividers in mobile view to save space or just let headers act as dividers
                    });
                }
            });
        }

        function attachMobileClick(btn) {
            btn.addEventListener('click', () => {
                const target = btn.dataset.src;
                if(target) {
                    frame.src = target;
                    // Update active state in both navs
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    // Find original and add active
                    const orig = document.querySelector(`.tab-btn[data-src="${target}"]`);
                    if(orig) orig.classList.add('active');
                    // Add active to this mobile btn (and siblings in drawer)
                    // Actually, re-rendering drawer might be overkill, just setting active class is fine
                    // Since we clone, the mobile btn is new. 
                    // Let's just manually set active on all matching data-src
                    document.querySelectorAll(`.tab-btn[data-src="${target}"]`).forEach(b => b.classList.add('active'));
                    
                    toggleMobileMenu(); // Close menu
                }
            });
        }

    </script>
</body>
</html>
