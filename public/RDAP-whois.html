<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>RDAP Tool</title>
    <style>
        body { background: #0f172a; color: #e2e8f0; font-family: -apple-system, sans-serif; padding: 20px; line-height: 1.5; }
        .container { max-width: 900px; margin: 0 auto; background: #1e293b; padding: 25px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        
        h2 { margin-top: 0; color: #818cf8; border-bottom: 1px solid #334155; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .ver { font-size: 12px; color: #475569; }
        .section { margin-bottom: 20px; }
        
        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        select, input, textarea { background: #0f172a; color: #fff; border: 1px solid #334155; padding: 12px; border-radius: 6px; font-size: 15px; }
        select { flex: 1; cursor: pointer; }
        input { flex: 2; }
        textarea { width: 100%; height: 180px; font-family: 'Consolas', monospace; font-size: 12px; resize: vertical; border-color: #4f46e5; }

        button { padding: 10px 20px; cursor: pointer; background: #4f46e5; color: white; border: none; border-radius: 6px; font-weight: 600; transition: 0.2s; }
        button:hover { background: #6366f1; }
        .btn-sec { background: #334155; color: #cbd5e1; }
        .btn-sec:hover { background: #475569; color: #fff; }
        .btn-parse { background: #059669; width: 100%; margin-top: 10px; font-size: 16px; }
        .btn-export { background: #d97706; }
        .btn-export:hover { background: #f59e0b; }

        .result-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 15px; margin-top: 20px; }
        .card { background: #0f172a; padding: 15px; border-radius: 8px; border-left: 4px solid #4f46e5; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .card-label { color: #64748b; font-size: 11px; text-transform: uppercase; margin-bottom: 5px; }
        .card-val { font-size: 14px; word-break: break-all; color: #f8fafc; font-weight: 500; }

        .status { color: #fbbf24; font-size: 13px; margin: 10px 0; min-height: 20px; }
        .hidden { display: none; }
        
        .hint { background: #2d1a1a; padding: 15px; border-radius: 8px; border: 1px solid #7f1d1d; color: #fca5a5; font-size: 14px; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2>RDAP å·¥å…· <span class="ver">Final Pro</span></h2>
    
    <div class="section">
        <div class="row">
            <select id="nodeSelect">
                <option value="https://rdap.org/domain/">rdap.org (é»˜è®¤é€’å½’æŸ¥è¯¢)</option>
                <option value="https://rdap.cnnic.cn/domain/">rdap.cnnic.cn (ä¸­å›½ .CN)</option>
                <option value="https://rdap.verisign.com/com/v1/domain/">rdap.verisign.com (.COM)</option>
                <option value="https://rdap.verisign.com/net/v1/domain/">rdap.verisign.com (.NET)</option>
                <option value="https://rdap.publicinterestregistry.org/rdap/domain/">pir.org (.ORG)</option>
                <option value="https://rdap.nic.ad.jp/domain/">nic.ad.jp (.JP)</option>
            </select>
            <button class="btn-sec" onclick="openNodeRoot()">è®¿é—®èŠ‚ç‚¹æ ¹ç›®å½•</button>
        </div>
        <div class="row">
            <input type="text" id="domainInput" placeholder="è¾“å…¥åŸŸå (ä¾‹å¦‚: 123.com æˆ– apple.net)">
            <button onclick="doSearch()">åœ¨çº¿è·å–å¹¶è§£æ</button>
        </div>
        <div id="status" class="status"></div>
    </div>

    <div class="section">
        <p style="font-size: 13px; color: #94a3b8; margin-bottom: 8px; display: flex; justify-content: space-between;">
            <span>JSON æ•°æ®äº¤äº’åŒº (è·å–åˆ°çš„æ•°æ®ä¼šè‡ªåŠ¨å¡«å…¥æ­¤å¤„)ï¼š</span>
            <span id="dataInfo" style="color:#059669"></span>
        </p>
        <textarea id="jsonInput" placeholder='ç­‰å¾…è·å–æ•°æ®æˆ–åœ¨æ­¤ç²˜è´´ JSON ä»£ç ...'></textarea>
        
        <div style="display: flex; gap: 10px;">
            <button class="btn-parse" onclick="parseManualJson()">è§£ææ–‡æœ¬æ¡†ä¸­çš„ JSON</button>
            <button id="exportBtn" class="btn-export btn-parse hidden" onclick="exportJsonFile()">å¯¼å‡ºä¸º .json æ–‡ä»¶</button>
        </div>
    </div>

    <div id="toolBar" class="hidden" style="margin-bottom:15px; border-top: 1px solid #334155; padding-top: 15px;">
        <button class="btn-sec" id="apiUrlBtn" onclick="window.open(currentFullUrl, '_blank')">ğŸŒ æ‰“å¼€åŸå§‹ API é¡µé¢</button>
        <button class="btn-sec" onclick="clearAll()">æ¸…ç©ºå…¨éƒ¨</button>
    </div>

    <div id="parseResult"></div>
</div>

<script>
    let currentFullUrl = "";
    let lastFetchedData = null;

    function openNodeRoot() {
        const root = document.getElementById('nodeSelect').value.split('domain/')[0];
        window.open(root, '_blank');
    }

    function updateStatus(msg) {
        document.getElementById('status').innerText = msg;
    }

    // æ ¸å¿ƒæ¸²æŸ“å‡½æ•°
    function renderRdapData(data) {
        const resultDiv = document.getElementById('parseResult');
        const exportBtn = document.getElementById('exportBtn');
        const toolBar = document.getElementById('toolBar');
        
        // 1. åŒæ­¥æ˜¾ç¤ºåˆ°æ–‡æœ¬æ¡†
        document.getElementById('jsonInput').value = JSON.stringify(data, null, 2);
        lastFetchedData = data;

        // 2. æ˜¾ç¤ºå·¥å…·æ å’Œä¸‹è½½æŒ‰é’®
        toolBar.classList.remove('hidden');
        exportBtn.classList.remove('hidden');

        // 3. æå–å­—æ®µé€»è¾‘
        const getRegistrar = () => {
            const ent = data.entities?.find(e => e.roles?.includes('registrar'));
            return ent?.vcardArray?.[1]?.find(i => i[0]==='fn')?.[3] || ent?.handle || "æœªçŸ¥";
        };

        const infoItems = [
            { label: "åŸŸåä¸»ä½“", val: data.ldhName },
            { label: "æ³¨å†Œå•†", val: getRegistrar() },
            { label: "çŠ¶æ€ (Status)", val: (data.status || []).join(' / ') },
            { label: "WHOIS æœåŠ¡å™¨", val: data.port43 },
        ];

        // æå–æ—¶é—´ç‚¹
        const events = (data.events || []).map(e => ({
            label: `æ—¶é—´ç‚¹: ${e.eventAction}`,
            val: new Date(e.eventDate).toLocaleString()
        }));

        const allItems = [...infoItems, ...events];

        let html = '<div class="result-grid">';
        allItems.forEach(item => {
            if(item.val) {
                html += `<div class="card">
                    <div class="card-label">${item.label}</div>
                    <div class="card-val">${item.val}</div>
                </div>`;
            }
        });
        html += '</div>';
        resultDiv.innerHTML = html;
        document.getElementById('dataInfo').innerText = "æ•°æ®å·²åŒæ­¥è‡³è§£æå™¨";
    }

    // åœ¨çº¿æŸ¥è¯¢
    async function doSearch() {
        const domain = document.getElementById('domainInput').value.trim();
        const server = document.getElementById('nodeSelect').value;
        
        if (!domain) return alert("è¯·è¾“å…¥åŸŸå");

        updateStatus("ğŸš€ æ­£åœ¨è¯·æ±‚ API æ•°æ®...");
        document.getElementById('parseResult').innerHTML = "";
        document.getElementById('dataInfo').innerText = "";
        currentFullUrl = server + domain;

        try {
            const response = await fetch(currentFullUrl);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            
            const data = await response.json();
            updateStatus("âœ… è·å–æˆåŠŸ");
            renderRdapData(data);
        } catch (err) {
            updateStatus("âŒ è‡ªåŠ¨è·å–å¤±è´¥ (CORSè·¨åŸŸé™åˆ¶æˆ–åŸŸåä¸å­˜åœ¨)");
            document.getElementById('parseResult').innerHTML = `
                <div class="hint">
                    <b>å—æµè§ˆå™¨å®‰å…¨æ”¿ç­–å½±å“ï¼Œè‡ªåŠ¨è§£æå¤±è´¥ã€‚</b><br>
                    è¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š<br>
                    1. ç‚¹å‡»ä¸‹æ–¹çš„è“è‰²æŒ‰é’®æ‰“å¼€ API é¡µé¢ã€‚<br>
                    2. <b>å…¨é€‰å¹¶å¤åˆ¶</b> é¡µé¢ä¸Šçš„æ‰€æœ‰ä»£ç ã€‚<br>
                    3. ç²˜è´´åˆ°ä¸­é—´æ–‡æœ¬æ¡†åç‚¹å‡» <b>â€œè§£ææ–‡æœ¬æ¡†ä¸­çš„ JSONâ€</b>ã€‚
                </div>`;
            document.getElementById('toolBar').classList.remove('hidden');
            document.getElementById('apiUrlBtn').classList.remove('hidden');
        }
    }

    // æ‰‹åŠ¨è§£æ
    function parseManualJson() {
        const input = document.getElementById('jsonInput').value;
        if(!input) return alert("æ–‡æœ¬æ¡†ä¸­æ²¡æœ‰æ•°æ®");
        try {
            const data = JSON.parse(input);
            updateStatus("æœ¬åœ°è§£æå®Œæˆ");
            renderRdapData(data);
        } catch (e) {
            alert("è§£æå¤±è´¥ï¼šJSON æ ¼å¼ä¸æ­£ç¡®ã€‚è¯·ç¡®ä¿æ‚¨å¤åˆ¶äº†å®Œæ•´çš„ { ... } æ‹¬å·å†…å®¹ã€‚");
        }
    }

    // å¯¼å‡ºæ–‡ä»¶åŠŸèƒ½
    function exportJsonFile() {
        if(!lastFetchedData) return;
        const dataStr = JSON.stringify(lastFetchedData, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = `rdap_${lastFetchedData.ldhName || 'export'}.json`;
        link.click();
        URL.revokeObjectURL(url);
    }

    function clearAll() {
        document.getElementById('jsonInput').value = "";
        document.getElementById('domainInput').value = "";
        document.getElementById('parseResult').innerHTML = "";
        document.getElementById('toolBar').classList.add('hidden');
        document.getElementById('exportBtn').classList.add('hidden');
        document.getElementById('dataInfo').innerText = "";
        updateStatus("");
        lastFetchedData = null;
    }
</script>

</body>
</html>