<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta name="theme-color" content="#0d0d12"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <title>Pixiv原图i.pximg.net</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>

    <div id="fullscreenPreview" class="fullscreen-preview"></div>
    
    <div id="contentPreviewPanel" class="content-preview-panel">
        <div class="content-preview-header">
            <h3>内容预览</h3>
            <button class="content-preview-close" onclick="closeContentPreview()">×</button>
        </div>
        <div class="content-preview-body">
            <div id="contentPreviewText" class="content-preview-text"></div>
            <div id="contentPreviewLinks" class="content-preview-links"></div>
        </div>
        <div class="content-preview-footer">
            <button class="btn-recursive" onclick="processSelectedLink()">加载选中链接</button>
            <button class="btn-close-preview" onclick="closeContentPreview()">关闭</button>
        </div>
    </div>
    
    <div id="floatingMenu" class="floating-menu">
        <button class="floating-menu-toggle" onclick="toggleFloatingMenu()" title="展开菜单">☰</button>
        <div class="mini-pager" id="miniPager">
            <button onclick="changeUrlPage(-1)" class="mini-pager-btn">◀</button>
            <div class="mini-page-indicator">
                <span>P</span>
                <input type="number" id="miniUrlPageInput" value="1" min="1" onchange="jumpUrlPage(this.value)"/>
            </div>
            <button onclick="changeUrlPage(1)" class="mini-pager-btn">▶</button>
        </div>
        <div class="floating-menu-content" id="floatingMenuContent">
            <div class="menu-header">
                <span class="menu-title">Pixiv Viewer</span>
                <select id="proxySelect" onchange="handleProxyChange()" class="header-proxy-select">
                    <option value="https://prox.futa.de5.net/">站长自建</option>
                    <option value="https://prox.spacetimee.xyz/">Github公开</option>
                    <option value="custom">自定义</option>
                </select>
                <button class="menu-collapse-btn" onclick="collapseMenu()" title="收起">━</button>
            </div>
            <input type="url" id="customProxyInput" class="custom-proxy-input compact-input" placeholder="自定义地址"/>
            <div class="menu-row">
                <input type="url" id="urlInput" class="compact-input flex-1" placeholder="输入Pixiv原图链接..." oninput="checkSecretCode(); updatePageControlFromUrl()"/>
            </div>
            <div class="menu-row actions-row">
                <button onclick="processLink()" class="btn-action btn-load">加载</button>
                <button onclick="loadApiImage()" class="btn-action btn-random">随机</button>
                <button onclick="copyConvertedLink()" class="btn-action btn-copy">复制</button>
            </div>
            <div class="menu-row pager-row-compact">
                <button onclick="changeUrlPage(-1)" class="pager-btn-compact">◀</button>
                <div class="page-indicator-compact">
                    <span>P</span>
                    <input type="number" id="urlPageInput" value="1" min="1" onchange="jumpUrlPage(this.value)"/>
                </div>
                <button onclick="changeUrlPage(1)" class="pager-btn-compact">▶</button>
            </div>
        </div>
    </div>

    <div class="preview-controls">
        <button id="downloadBtnMinimal" onclick="downloadImage()" title="下载">↓</button>
        <button id="toggleDetailsBtn" onclick="toggleDetailsPanel()" title="详情">i</button>
    </div>

    <div id="quickAccessContainer" class="quick-access-container">
        <button id="quickAccessBtn" class="quick-access-btn" onclick="openSecretSettings()" title="设置">S</button>
        <button id="galleryBtn" class="quick-access-btn" onclick="openGalleryBrowser()" title="图库">G</button>
        <button id="quickRandomBtn" class="quick-access-btn" onclick="quickRandomImage()" title="随机">R</button>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    

    <div id="detailsPanel" class="details-panel">
        <h3>详情</h3>
        <div id="detailsGridMinimal" class="details-grid"></div>
    </div>

    <div class="container" style="display:none;">
        <h1>Pixiv原图 <br> i.pximg.net</h1>

        <div id="errorMsg" class="error" style="display: none;"></div>
        <div id="infoMsg" class="info" style="display: none;"></div>

        <div id="resultLinkContainer" class="result-link-container" style="display: none;">
            <span class="result-link-label">链接：</span>
            <div id="resultLink" class="result-link" onclick="copyToClipboard(this)"></div>
        </div>

        <div id="imageContainer" class="image-container" style="display: none;">
            <div class="image-label">图片：</div>
            <div class="image-wrapper" id="imageWrapper">
                <div id="loadingIndicator" style="display: none; padding: 20px;">
                    <span class="loading"></span>
                    <span id="loadingText">加载中...</span>
                    <div id="progressContainer" style="margin-top: 10px; width: 100%; max-width: 300px; height: 5px; background: #3a3a4a; border-radius: 3px; overflow: hidden; display: none;">
                        <div id="progressBar" style="width: 0%; height: 100%; background: #6a5acd; transition: width 0.1s;"></div>
                    </div>
                    <div id="progressStats" style="font-size: 12px; color: #b19cd9; margin-top: 5px; display: none;">0%</div>
                </div>
                <img id="resultImage" src="" alt="Pixiv图片" style="display: none;" />
            </div>
            <div class="button-container">
                <button id="downloadBtn" class="show-original-btn" onclick="downloadImage()">下载</button>
            </div>
        </div>

        <div id="detailsContainer" class="details-container">
            <h3 style="margin-top: 0; color: #b19cd9; margin-bottom: 10px;">详情</h3>
            <div id="detailsGrid" class="details-grid"></div>
        </div>
    </div>

    <!-- 静态资源页面 -->
    <div id="secretSettings" class="secret-settings">
        <div class="secret-settings-content">
            <h2>静态资源</h2>
            
            <!-- 功能切换按钮 -->
            <div class="function-toggle">
                <button id="staticResourceBtn" class="active" onclick="switchFunction('static')">静态资源</button>
                <button id="AnotherBtn" onclick="switchFunction('Another')">另一个静态资源-PikPak</button>
            </div>
            
            <!-- 静态资源部分 -->
            <div id="staticResourceSection">
                <div class="secret-input-group">
                    <label for="secretProxySelect">选择服务器：</label>
                    <select id="secretProxySelect" onchange="handleSecretProxyChange()">
                        <option value="https://prox.futa.de5.net/">站长自建</option>
                        <option value="https://prox.spacetimee.xyz/">Github大佬公开</option>
                        <option value="custom">自定义</option>
                    </select>
                    <input 
                        type="url" 
                        id="secretCustomProxyInput" 
                        class="custom-proxy-input"
                        placeholder="请输入自定义网址，例如：https://prox.mydomain.com/"
                    />
                </div>
                <div class="secret-input-group">
                    <label for="secretInput">输入内容：</label>
                    <input 
                        type="text" 
                        id="secretInput" 
                        placeholder="请输入静态资源链接..."
                    />
                </div>
            </div>
            
            <!-- 另一个静态资源部分 -->
            <div id="AnotherSection" style="display: none;">
                <div class="secret-input-group">
                    <label for="AnotherInput">输入链接：</label>
                    <input 
                        type="text" 
                        id="AnotherInput" 
                        placeholder="请输入链接..."
                    />
                </div>
            </div>
            
            <div class="secret-buttons">
                <button onclick="handleSecretAction()">执行操作</button>
                <button class="close-secret" onclick="closeSecretSettings()">关闭</button>
            </div>
        </div>
    </div>

        <!-- Gallery Browser Modal -->
    <div id="galleryBrowser" class="secret-settings" style="display: none;">
        <div class="secret-settings-content" style="max-width: 1200px; width: 95%; height: 90vh; display: flex; flex-direction: column; overflow: hidden;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; flex-shrink: 0;">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <h2 style="margin: 0;">图库浏览</h2>
                    <button onclick="pickRandomImage()" style="margin: 0; padding: 8px 15px; background: #ff9f43; font-size: 14px; border-radius: 4px; border: none; cursor: pointer; color: white;">🎲 随机一图</button>
                    <label class="thumb-option" for="useThumbCheckbox">
                        <input type="checkbox" id="useThumbCheckbox" />
                        使用缩略图
                    </label>
                </div>
                <button class="close-secret" onclick="closeGalleryBrowser()" style="width: auto; padding: 5px 15px;">✕</button>
            </div>
            
            <div class="gallery-body">
                <div class="gallery-sidebar">
                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">数据源</label>
                        <select id="galleryCsvSelect" onchange="loadGalleryData()" style="padding: 10px; background: #3a3a4a; border: 1px solid #4b0082; color: #e6e6fa; border-radius: 4px;">
                            <!-- Options injected via JS -->
                        </select>
                        <input type="file" id="localCsvInput" accept=".csv" style="display:none;">
                    </div>

                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">搜索</label>
                        <input type="text" id="gallerySearch" placeholder="搜索标题、描述、ID..." style="padding: 10px; background: #3a3a4a; border: 1px solid #4b0082; color: #e6e6fa; border-radius: 4px;">
                    </div>
                
                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">排序</label>
                        <select id="gallerySort" style="padding: 10px; background: #3a3a4a; border: 1px solid #4b0082; color: #e6e6fa; border-radius: 4px;">
                            <option value="newest">📅 日期最新</option>
                            <option value="oldest">📅 日期最早</option>
                            <option value="id_desc">🔢 ID 降序</option>
                            <option value="id_asc">🔢 ID 升序</option>
                            <option value="view_desc">👁️ 浏览最多</option>
                            <option value="like_desc">❤️ 收藏最多</option>
                        </select>
                    </div>

                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">标签筛选</label>
                        <div class="filters-row">
                            <div class="tag-dropdown">
                                <button id="openTagInclude" style="padding:8px 10px;">选择包含标签</button>
                                <div id="tagIncludePanel" class="tag-panel"></div>
                            </div>
                            <div class="tag-dropdown">
                                <button id="openTagExclude" style="padding:8px 10px;">选择排除标签</button>
                                <div id="tagExcludePanel" class="tag-panel"></div>
                            </div>
                        </div>
                    </div>
                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">已选标签</label>
                        <div class="selected-tags-row">
                            <div class="selected-group">
                                <span class="selected-label">包含</span>
                                <div id="selectedInclude" class="selected-tags"></div>
                            </div>
                            <div class="selected-group">
                                <span class="selected-label">排除</span>
                                <div id="selectedExclude" class="selected-tags"></div>
                            </div>
                            <button id="clearSelectedTags" class="pager-btn">清空</button>
                        </div>
                    </div>

                    <div class="input-wrapper">
                        <label style="display:block; color:#b19cd9; margin-bottom:5px; font-size:14px;">显示选项</label>
                        <div class="filters-row">
                            <select id="galleryAiFilter" class="pager-select">
                                <option value="">🤖 AI: 全部</option>
                                <option value="YES">AI: 是</option>
                                <option value="NO">AI: 否</option>
                            </select>
                            <select id="galleryDateFormat" class="pager-select">
                                <option value="raw">原始</option>
                                <option value="local">本地格式</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="galleryStatus" style="color: #888; font-size: 12px; margin-top: 10px; word-break: break-all;"></div>
                </div>

                <!-- Main: Table -->
                <div class="gallery-main">
                    <div class="gallery-table-container">
                        <table class="gallery-table">
                            <thead>
                                <tr>
                                    <th class="th-center action-col">操作</th>
                                    <th class="th-left">ID</th>
                                    <th class="th-left">标题</th>
                                    <th class="th-left">描述</th>
                                    <th class="th-left">文件名</th>
                                    <th class="th-left">标签</th>
                                    <th class="th-left">页码</th>
                                    <th class="th-left">限制级</th>
                                    <th class="th-left">日期</th>
                                    <th class="th-left">浏览</th>
                                    <th class="th-left">收藏</th>
                                </tr>
                            </thead>
                            <tbody id="galleryTableBody">
                                <!-- Data injected via JS -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination Controls -->
                    <div id="galleryPagination" class="pager-row">
                        <label for="perPageSelect" style="color:#b19cd9;">每页</label>
                        <select id="perPageSelect" class="pager-select">
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                        <button id="prevPageBtn" class="pager-btn">上一页</button>
                        <button id="nextPageBtn" class="pager-btn">下一页</button>
                        <span id="pageInfo" style="color:#888; font-size:12px;">第 1 / 1 页</span>
                        <input id="pageInput" type="number" min="1" value="1" class="pager-input">
                        <button id="jumpPageBtn" class="pager-btn">跳转</button>
                    </div>
                    
                    <div id="galleryLoading" style="text-align: center; padding: 20px; display: none;">
                        <span class="loading"></span> 正在加载数据...
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    

    <script src="app.js"></script>
</body>
</html>