<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64å›¾ç‰‡åŒå‘è½¬æ¢å·¥å…·</title>
    <style>
        /* æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #e0e0e0;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: #bb86fc;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
        }

        .subtitle {
            color: #b0b0b0;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(187, 134, 252, 0.1);
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            color: #bb86fc;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(187, 134, 252, 0.2);
        }

        .upload-area {
            border: 3px dashed #bb86fc;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            background: rgba(187, 134, 252, 0.05);
        }

        .upload-area:hover {
            background-color: rgba(187, 134, 252, 0.1);
            border-color: #9d4edd;
            box-shadow: 0 0 20px rgba(187, 134, 252, 0.2);
        }

        .upload-area i {
            font-size: 48px;
            color: #bb86fc;
            margin-bottom: 15px;
            filter: drop-shadow(0 0 5px rgba(187, 134, 252, 0.5));
        }

        .upload-area p {
            margin-bottom: 15px;
            color: #b0b0b0;
        }

        #fileInput {
            display: none;
        }

        .preview-container {
            text-align: center;
        }

        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            margin-bottom: 15px;
            border: 2px solid rgba(187, 134, 252, 0.2);
        }

        .file-info {
            background: rgba(40, 40, 60, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            text-align: left;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }

        .file-info p {
            margin-bottom: 8px;
            word-break: break-all;
        }

        .file-info strong {
            color: #bb86fc;
        }

        .code-container {
            position: relative;
            margin-top: 20px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            background: rgba(20, 20, 35, 0.8);
            color: #e0e0e0;
            border: 1px solid rgba(187, 134, 252, 0.2);
        }

        textarea:focus {
            outline: none;
            border-color: #bb86fc;
            box-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #9d4edd, #bb86fc);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .copy-btn:hover {
            background: linear-gradient(45deg, #bb86fc, #9d4edd);
            box-shadow: 0 0 15px rgba(187, 134, 252, 0.4);
            transform: translateY(-2px);
        }

        .actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(187, 134, 252, 0.1);
            color: #bb86fc;
            border: 1px solid rgba(187, 134, 252, 0.3);
        }

        .btn:hover {
            background: rgba(187, 134, 252, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(187, 134, 252, 0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #6200ea, #9d4edd);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(45deg, #9d4edd, #6200ea);
            box-shadow: 0 5px 20px rgba(157, 78, 221, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #3700b3, #6200ea);
            color: white;
            border: none;
        }

        .btn-secondary:hover {
            background: linear-gradient(45deg, #6200ea, #3700b3);
            box-shadow: 0 5px 20px rgba(98, 0, 234, 0.4);
        }

        .btn-tertiary {
            background: linear-gradient(45deg, #560bad, #7209b7);
            color: white;
            border: none;
        }

        .btn-tertiary:hover {
            background: linear-gradient(45deg, #7209b7, #560bad);
            box-shadow: 0 5px 20px rgba(114, 9, 183, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #00c853, #00e676);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background: linear-gradient(45deg, #00e676, #00c853);
            box-shadow: 0 5px 20px rgba(0, 230, 118, 0.4);
        }

        .format-options {
            margin: 20px 0;
            padding: 15px;
            background: rgba(40, 40, 60, 0.6);
            border-radius: 8px;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }

        .format-options label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .format-options label:hover {
            background: rgba(187, 134, 252, 0.1);
        }

        .format-options input[type="radio"] {
            margin-right: 10px;
            accent-color: #bb86fc;
        }

        .usage-steps {
            margin-top: 30px;
            background: rgba(30, 30, 46, 0.8);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(187, 134, 252, 0.1);
        }

        .usage-steps h3 {
            color: #bb86fc;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(187, 134, 252, 0.3);
        }

        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .step {
            background: rgba(40, 40, 60, 0.6);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #bb86fc;
            transition: transform 0.3s;
        }

        .step:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .step h4 {
            color: #bb86fc;
            margin-bottom: 10px;
        }

        .step p {
            color: #b0b0b0;
        }

        .icon {
            display: inline-block;
            font-style: normal;
            font-weight: bold;
            margin-right: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #bb86fc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
            filter: drop-shadow(0 0 5px rgba(187, 134, 252, 0.5));
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #9d4edd, #bb86fc);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            z-index: 1000;
            transform: translateY(20px);
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* æ–°å¢ï¼šBase64è¾“å…¥åŒºåŸŸæ ·å¼ */
        .base64-input-container {
            margin-top: 20px;
            position: relative;
        }
        
        .base64-input-container label {
            display: block;
            margin-bottom: 8px;
            color: #bb86fc;
            font-weight: 600;
        }
        
        .base64-input-container textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
        }
        
        .base64-input-container .hint {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        /* æ–°å¢ï¼šBase64è§£ç é¢„è§ˆåŒºåŸŸæ ·å¼ */
        .decode-preview {
            text-align: center;
            margin-top: 20px;
            display: none;
        }
        
        #decodeImagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            margin-bottom: 15px;
            border: 2px solid rgba(187, 134, 252, 0.2);
        }
        
        .decode-info {
            background: rgba(40, 40, 60, 0.6);
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }
        
        .decode-info p {
            margin-bottom: 8px;
            word-break: break-all;
        }
        
        .decode-info strong {
            color: #bb86fc;
        }
        
        /* æ–°å¢ï¼šè½¬æ¢æ–¹å‘åˆ‡æ¢æ ·å¼ */
        .conversion-mode {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(40, 40, 60, 0.6);
            border: 1px solid rgba(187, 134, 252, 0.1);
        }
        
        .conversion-mode button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #b0b0b0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .conversion-mode button.active {
            background: linear-gradient(45deg, #6200ea, #9d4edd);
            color: white;
        }
        
        .conversion-mode button:hover:not(.active) {
            background: rgba(187, 134, 252, 0.1);
        }
        
        /* æ–°å¢ï¼šé¢æ¿å†…å®¹åŒºåŸŸ */
        .panel-content {
            display: block;
        }
        
        /* æ–°å¢ï¼šä¸‹è½½æŒ‰é’®æ ·å¼ */
        .download-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 30, 46, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #9d4edd, #bb86fc);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #bb86fc, #9d4edd);
        }

        /* é€‰æ‹©æ–‡æœ¬æ ·å¼ */
        ::selection {
            background: rgba(187, 134, 252, 0.3);
            color: white;
        }

        /* å‘å…‰æ•ˆæœ */
        .glow-effect {
            position: relative;
        }

        .glow-effect::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #bb86fc, #9d4edd, #6200ea, #3700b3);
            border-radius: 10px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .glow-effect:hover::after {
            opacity: 0.3;
        }
        
        /* æ–°å¢ï¼šé”™è¯¯ä¿¡æ¯æ ·å¼ */
        .error-message {
            color: #ff6b6b;
            background: rgba(207, 102, 121, 0.1);
            border: 1px solid rgba(207, 102, 121, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        
        /* æ–°å¢ï¼šæ‰‹åŠ¨è§£ç æŒ‰é’®æ ·å¼ */
        .decode-btn {
            margin-top: 10px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Base64å›¾ç‰‡åŒå‘è½¬æ¢å·¥å…·</h1>
            <p class="subtitle">æ”¯æŒå›¾ç‰‡è½¬Base64ç¼–ç å’ŒBase64è§£ç ä¸ºå›¾ç‰‡</p>
        </header>

        <div class="main-content">
            <div class="panel">
                <div class="conversion-mode">
                    <button id="toBase64Btn" class="active">å›¾ç‰‡è½¬Base64</button>
                    <button id="toImageBtn">Base64è½¬å›¾ç‰‡</button>
                </div>
                
                <!-- å›¾ç‰‡è½¬Base64é¢æ¿ -->
                <div id="toBase64Panel" class="panel-content">
                    <h2>ä¸Šä¼ å›¾ç‰‡</h2>
                    <div class="upload-area glow-effect" id="uploadArea">
                        <div class="icon">ğŸ“</div>
                        <p>ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
                        <p>æ”¯æŒ JPG, PNG, GIF, SVG, WebP æ ¼å¼</p>
                        <input type="file" id="fileInput" accept="image/*">
                    </div>

                    <div class="preview-container" id="previewContainer" style="display: none;">
                        <img id="imagePreview" src="" alt="å›¾ç‰‡é¢„è§ˆ">
                        <div class="file-info">
                            <p><strong>æ–‡ä»¶å:</strong> <span id="fileName"></span></p>
                            <p><strong>æ–‡ä»¶å¤§å°:</strong> <span id="fileSize"></span></p>
                            <p><strong>å›¾ç‰‡å°ºå¯¸:</strong> <span id="imageDimensions"></span></p>
                            <p><strong>MIMEç±»å‹:</strong> <span id="fileType"></span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Base64è½¬å›¾ç‰‡é¢æ¿ -->
                <div id="toImagePanel" class="panel-content" style="display: none;">
                    <h2>è¾“å…¥Base64ç¼–ç </h2>
                    <div class="base64-input-container">
                        <label for="base64Input">Base64ç¼–ç å­—ç¬¦ä¸²ï¼š</label>
                        <textarea id="base64Input" placeholder="ç²˜è´´Base64ç¼–ç å­—ç¬¦ä¸²æˆ–data URI..."></textarea>
                        <div class="error-message" id="base64Error"></div>
                        <div class="hint">æç¤ºï¼šå¯ä»¥ç²˜è´´å®Œæ•´çš„data URIï¼ˆå¦‚data:image/png;base64,xxxï¼‰æˆ–çº¯Base64ç¼–ç </div>
                        <button class="btn btn-primary decode-btn" id="decodeBtn">
                            <span class="icon">ğŸ”</span> è§£ç Base64
                        </button>
                    </div>
                    
                    <div class="decode-preview" id="decodePreviewContainer">
                        <img id="decodeImagePreview" src="" alt="è§£ç å›¾ç‰‡é¢„è§ˆ">
                        <div class="decode-info">
                            <p><strong>è§£ç çŠ¶æ€:</strong> <span id="decodeStatus"></span></p>
                            <p><strong>å›¾ç‰‡æ ¼å¼:</strong> <span id="decodeFormat"></span></p>
                            <p><strong>æ•°æ®é•¿åº¦:</strong> <span id="decodeLength"></span> å­—ç¬¦</p>
                            <p><strong>æ–‡ä»¶å¤§å°:</strong> <span id="decodeFileSize"></span></p>
                        </div>
                        <div class="download-actions">
                            <button class="btn btn-success btn-small" id="downloadImageBtn">
                                <span class="icon">ğŸ’¾</span> ä¸‹è½½å›¾ç‰‡
                            </button>
                            <button class="btn btn-tertiary btn-small" id="copyBase64Btn">
                                <span class="icon">ğŸ“‹</span> å¤åˆ¶Base64
                            </button>
                            <button class="btn btn-tertiary btn-small" id="clearBase64Btn">
                                <span class="icon">ğŸ—‘ï¸</span> æ¸…é™¤
                            </button>
                        </div>
                    </div>
                    
                    <div class="loading" id="decodeLoading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨è§£ç ä¸­ï¼Œè¯·ç¨å€™...</p>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è½¬æ¢ä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>

            <div class="panel">
                <h2>Base64ç¼–ç ç»“æœ</h2>
                <div class="format-options">
                    <label>
                        <input type="radio" name="format" value="full" checked>
                        å®Œæ•´æ ¼å¼ (åŒ…å«data:image/æ ¼å¼;base64,å‰ç¼€)
                    </label>
                    <label>
                        <input type="radio" name="format" value="raw">
                        åŸå§‹Base64ç¼–ç  (ä»…ç¼–ç éƒ¨åˆ†)
                    </label>
                    <label>
                        <input type="radio" name="format" value="css">
                        CSSèƒŒæ™¯æ ¼å¼
                    </label>
                    <label>
                        <input type="radio" name="format" value="html">
                        HTMLå›¾ç‰‡æ ‡ç­¾æ ¼å¼
                    </label>
                </div>

                <div class="code-container">
                    <textarea id="base64Output" placeholder="Base64ç¼–ç å°†åœ¨è¿™é‡Œæ˜¾ç¤º..." readonly></textarea>
                    <button class="copy-btn" id="copyBtn">å¤åˆ¶ä»£ç </button>
                </div>

                <div class="actions">
                    <button class="btn btn-primary" id="exportHtmlBtn">
                        <span class="icon">ğŸ“„</span> å¯¼å‡ºHTMLæ–‡ä»¶
                    </button>
                    <button class="btn btn-secondary" id="exportCssBtn">
                        <span class="icon">ğŸ¨</span> å¯¼å‡ºCSSæ–‡ä»¶
                    </button>
                    <button class="btn btn-tertiary" id="resetBtn">
                        <span class="icon">ğŸ”„</span> é‡ç½®
                    </button>
                </div>
            </div>
        </div>

        <div class="usage-steps">
            <h3>ä½¿ç”¨è¯´æ˜</h3>
            <div class="steps">
                <div class="step">
                    <h4>1. é€‰æ‹©è½¬æ¢æ–¹å‘</h4>
                    <p>é€‰æ‹©"å›¾ç‰‡è½¬Base64"æˆ–"Base64è½¬å›¾ç‰‡"æ¨¡å¼ã€‚</p>
                </div>
                <div class="step">
                    <h4>2. ä¸Šä¼ æˆ–è¾“å…¥</h4>
                    <p>ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶æˆ–ç²˜è´´Base64ç¼–ç å­—ç¬¦ä¸²ã€‚</p>
                </div>
                <div class="step">
                    <h4>3. éªŒè¯å’Œè§£ç </h4>
                    <p>ç‚¹å‡»"è§£ç Base64"æŒ‰é’®éªŒè¯å¹¶è§£ç å›¾ç‰‡ã€‚</p>
                </div>
                <div class="step">
                    <h4>4. å¤åˆ¶æˆ–ä¸‹è½½</h4>
                    <p>å¤åˆ¶Base64ä»£ç æˆ–ä¸‹è½½è§£ç åçš„å›¾ç‰‡æ–‡ä»¶ã€‚</p>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // DOMå…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const previewContainer = document.getElementById('previewContainer');
        const imagePreview = document.getElementById('imagePreview');
        const base64Output = document.getElementById('base64Output');
        const copyBtn = document.getElementById('copyBtn');
        const exportHtmlBtn = document.getElementById('exportHtmlBtn');
        const exportCssBtn = document.getElementById('exportCssBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loading = document.getElementById('loading');
        const toast = document.getElementById('toast');
        const formatRadios = document.querySelectorAll('input[name="format"]');
        
        // æ–°å¢DOMå…ƒç´ 
        const toBase64Btn = document.getElementById('toBase64Btn');
        const toImageBtn = document.getElementById('toImageBtn');
        const toBase64Panel = document.getElementById('toBase64Panel');
        const toImagePanel = document.getElementById('toImagePanel');
        const base64Input = document.getElementById('base64Input');
        const decodePreviewContainer = document.getElementById('decodePreviewContainer');
        const decodeImagePreview = document.getElementById('decodeImagePreview');
        const decodeLoading = document.getElementById('decodeLoading');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const clearBase64Btn = document.getElementById('clearBase64Btn');
        const copyBase64Btn = document.getElementById('copyBase64Btn');
        const decodeBtn = document.getElementById('decodeBtn');
        const base64Error = document.getElementById('base64Error');
        const decodeStatus = document.getElementById('decodeStatus');
        const decodeFormat = document.getElementById('decodeFormat');
        const decodeLength = document.getElementById('decodeLength');
        const decodeFileSize = document.getElementById('decodeFileSize');

        // æ–‡ä»¶ä¿¡æ¯å…ƒç´ 
        const fileName = document.getElementById('fileName');
        const fileSize = document.getElementById('fileSize');
        const imageDimensions = document.getElementById('imageDimensions');
        const fileType = document.getElementById('fileType');

        // å½“å‰å¤„ç†çš„å›¾ç‰‡æ•°æ®
        let currentImageData = null;
        let currentFileName = '';
        let currentMimeType = '';
        
        // Base64è§£ç ç›¸å…³å˜é‡
        let decodedImageData = null;
        let decodedMimeType = '';
        let decodedFileName = 'decoded-image';
        let originalBase64String = '';

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            toast.textContent = message;
            if (type === 'error') {
                toast.style.background = 'linear-gradient(45deg, #cf6679, #b00020)';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(45deg, #ffb74d, #f57c00)';
            } else {
                toast.style.background = 'linear-gradient(45deg, #9d4edd, #bb86fc)';
            }
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            base64Error.textContent = message;
            base64Error.style.display = 'block';
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            base64Error.style.display = 'none';
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // è·å–å›¾ç‰‡MIMEç±»å‹å‰ç¼€
        function getMimePrefix(mimeType) {
            const mimeMap = {
                'image/jpeg': 'data:image/jpeg;base64,',
                'image/jpg': 'data:image/jpeg;base64,',
                'image/png': 'data:image/png;base64,',
                'image/gif': 'data:image/gif;base64,',
                'image/svg+xml': 'data:image/svg+xml;base64,',
                'image/webp': 'data:image/webp;base64,'
            };
            return mimeMap[mimeType] || 'data:image;base64,';
        }

        // éªŒè¯Base64å­—ç¬¦ä¸²
        function validateBase64(base64String) {
            // æ¸…é™¤ç©ºç™½å­—ç¬¦
            const cleanString = base64String.trim();
            
            if (!cleanString) {
                return { valid: false, error: 'è¯·è¾“å…¥Base64ç¼–ç å­—ç¬¦ä¸²' };
            }
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºå®Œæ•´çš„data URI
            if (cleanString.startsWith('data:image/')) {
                const matches = cleanString.match(/^data:(image\/[a-zA-Z+]+);base64,(.+)$/);
                if (!matches || matches.length !== 3) {
                    return { valid: false, error: 'æ— æ•ˆçš„data URIæ ¼å¼ã€‚æ ¼å¼åº”ä¸º: data:image/æ ¼å¼;base64,ç¼–ç ' };
                }
                
                const mimeType = matches[1];
                const base64Data = matches[2];
                
                // éªŒè¯Base64æ•°æ®
                if (!isValidBase64(base64Data)) {
                    return { valid: false, error: 'Base64æ•°æ®æ ¼å¼ä¸æ­£ç¡®' };
                }
                
                return { 
                    valid: true, 
                    mimeType, 
                    base64Data,
                    isDataURI: true,
                    original: cleanString
                };
            } else {
                // çº¯Base64å­—ç¬¦ä¸²
                if (!isValidBase64(cleanString)) {
                    return { valid: false, error: 'æ— æ•ˆçš„Base64ç¼–ç å­—ç¬¦ä¸²' };
                }
                
                // å°è¯•æ£€æµ‹MIMEç±»å‹
                let mimeType = 'image/png'; // é»˜è®¤
                if (cleanString.charAt(0) === '/') {
                    mimeType = 'image/jpeg';
                } else if (cleanString.charAt(0) === 'i') {
                    mimeType = 'image/png';
                } else if (cleanString.startsWith('R0lGOD')) {
                    mimeType = 'image/gif';
                } else if (cleanString.startsWith('UklGR')) {
                    mimeType = 'image/webp';
                }
                
                return { 
                    valid: true, 
                    mimeType, 
                    base64Data: cleanString,
                    isDataURI: false,
                    original: cleanString
                };
            }
        }

        // æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„Base64å­—ç¬¦ä¸²
        function isValidBase64(str) {
            try {
                // ç§»é™¤å¯èƒ½çš„æ¢è¡Œç¬¦å’Œç©ºæ ¼
                const cleanStr = str.replace(/\s/g, '');
                
                // Base64æ­£åˆ™è¡¨è¾¾å¼
                const base64Regex = /^[A-Za-z0-9+/]*={0,2}$/;
                if (!base64Regex.test(cleanStr)) {
                    return false;
                }
                
                // å°è¯•è§£ç 
                const decoded = atob(cleanStr);
                return true;
            } catch (e) {
                return false;
            }
        }

        // è½¬æ¢å›¾ç‰‡ä¸ºBase64
        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                
                reader.onerror = function(e) {
                    reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                };
                
                reader.readAsDataURL(file);
            });
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        async function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                showToast('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loading.style.display = 'block';
            previewContainer.style.display = 'none';

            try {
                // è·å–å›¾ç‰‡ä¿¡æ¯
                currentFileName = file.name;
                currentMimeType = file.type;
                
                // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
                fileName.textContent = currentFileName;
                fileSize.textContent = formatFileSize(file.size);
                fileType.textContent = currentMimeType;

                // åˆ›å»ºå›¾ç‰‡å¯¹è±¡è·å–å°ºå¯¸
                const img = new Image();
                const objectUrl = URL.createObjectURL(file);
                
                await new Promise((resolve, reject) => {
                    img.onload = function() {
                        imageDimensions.textContent = `${img.width} Ã— ${img.height} åƒç´ `;
                        resolve();
                    };
                    img.onerror = reject;
                    img.src = objectUrl;
                });

                // é¢„è§ˆå›¾ç‰‡
                imagePreview.src = objectUrl;
                
                // è½¬æ¢å›¾ç‰‡ä¸ºBase64
                currentImageData = await convertImageToBase64(file);
                
                // æ›´æ–°Base64è¾“å‡º
                updateBase64Output();
                
                // æ˜¾ç¤ºé¢„è§ˆ
                previewContainer.style.display = 'block';
                
                showToast('å›¾ç‰‡è½¬æ¢æˆåŠŸï¼');
                
            } catch (error) {
                showToast('å¤„ç†å›¾ç‰‡æ—¶å‘ç”Ÿé”™è¯¯: ' + error.message, 'error');
                console.error(error);
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                loading.style.display = 'none';
            }
        }

        // æ ¹æ®é€‰æ‹©çš„æ ¼å¼æ›´æ–°Base64è¾“å‡º
        function updateBase64Output() {
            if (!currentImageData) return;
            
            const selectedFormat = document.querySelector('input[name="format"]:checked').value;
            let output = '';
            
            switch(selectedFormat) {
                case 'full':
                    // å®Œæ•´æ ¼å¼
                    output = currentImageData;
                    break;
                    
                case 'raw':
                    // åŸå§‹Base64ç¼–ç 
                    output = currentImageData.split(',')[1];
                    break;
                    
                case 'css':
                    // CSSèƒŒæ™¯æ ¼å¼
                    const mimePrefix = getMimePrefix(currentMimeType);
                    const base64Raw = currentImageData.split(',')[1];
                    output = `.base64-image {\n  background-image: url('${mimePrefix}${base64Raw}');\n  width: 100%;\n  height: auto;\n}`;
                    break;
                    
                case 'html':
                    // HTMLå›¾ç‰‡æ ‡ç­¾æ ¼å¼
                    output = `<img src="${currentImageData}" alt="${currentFileName.replace(/\.[^/.]+$/, '')}" width="100%" height="auto">`;
                    break;
            }
            
            base64Output.value = output;
        }

        // å¯¼å‡ºHTMLæ–‡ä»¶
        function exportHtml() {
            if (!currentImageData) {
                showToast('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                return;
            }
            
            const htmlContent = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64å›¾ç‰‡ - ${currentFileName}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            text-align: center;
            background: #0f0c29;
            color: #e0e0e0;
        }
        .image-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid rgba(187, 134, 252, 0.3);
            border-radius: 10px;
            background: rgba(30, 30, 46, 0.8);
        }
        h1 {
            color: #bb86fc;
        }
        .info {
            text-align: left;
            background: rgba(40, 40, 60, 0.6);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            border: 1px solid rgba(187, 134, 252, 0.1);
        }
    </style>
</head>
<body>
    <h1>Base64å›¾ç‰‡ç¤ºä¾‹</h1>
    <div class="image-container">
        <img src="${currentImageData}" alt="${currentFileName.replace(/\.[^/.]+$/, '')}" style="max-width: 100%; height: auto;">
    </div>
    <div class="info">
        <h3>å›¾ç‰‡ä¿¡æ¯:</h3>
        <p><strong>æ–‡ä»¶å:</strong> ${currentFileName}</p>
        <p><strong>MIMEç±»å‹:</strong> ${currentMimeType}</p>
        <p><strong>Base64æ•°æ®URIé•¿åº¦:</strong> ${currentImageData.length} å­—ç¬¦</p>
    </div>
</body>
</html>`;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `base64-image-${currentFileName.replace(/\.[^/.]+$/, '')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('HTMLæ–‡ä»¶å·²å¯¼å‡º');
        }

        // å¯¼å‡ºCSSæ–‡ä»¶
        function exportCss() {
            if (!currentImageData) {
                showToast('è¯·å…ˆä¸Šä¼ å›¾ç‰‡', 'error');
                return;
            }
            
            const mimePrefix = getMimePrefix(currentMimeType);
            const base64Raw = currentImageData.split(',')[1];
            const className = currentFileName.replace(/\.[^/.]+$/, '').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
            
            const cssContent = `/* Base64å›¾ç‰‡æ ·å¼ - ${currentFileName} */
.${className}-background {
    /* ä½¿ç”¨Base64ç¼–ç çš„å›¾ç‰‡ä½œä¸ºèƒŒæ™¯ */
    background-image: url('${mimePrefix}${base64Raw}');
    background-repeat: no-repeat;
    background-size: contain;
    background-position: center;
    width: 100%;
    height: auto;
    min-height: 200px;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .${className}-background {
        min-height: 150px;
    }
}

/* ä½¿ç”¨ç¤ºä¾‹:
<div class="${className}-background"></div>
*/`;
            
            const blob = new Blob([cssContent], { type: 'text/css' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `base64-${className}.css`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('CSSæ–‡ä»¶å·²å¯¼å‡º');
        }

        // é‡ç½®æ‰€æœ‰å†…å®¹
        function resetAll() {
            fileInput.value = '';
            previewContainer.style.display = 'none';
            base64Output.value = '';
            currentImageData = null;
            currentFileName = '';
            currentMimeType = '';
            showToast('å·²é‡ç½®', 'warning');
        }

        // å¤åˆ¶Base64ä»£ç åˆ°å‰ªè´´æ¿
        async function copyToClipboard() {
            if (!base64Output.value.trim()) {
                showToast('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶', 'error');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(base64Output.value);
                showToast('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (err) {
                // é™çº§æ–¹æ¡ˆ
                base64Output.select();
                base64Output.setSelectionRange(0, 99999);
                document.execCommand('copy');
                showToast('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // Base64è½¬å›¾ç‰‡åŠŸèƒ½
        async function decodeBase64ToImage() {
            const base64String = base64Input.value.trim();
            
            // éšè—ä¹‹å‰çš„é”™è¯¯
            hideError();
            
            // éªŒè¯è¾“å…¥
            const validation = validateBase64(base64String);
            if (!validation.valid) {
                showError(validation.error);
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„Base64ç¼–ç ', 'error');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            decodeLoading.style.display = 'block';
            decodePreviewContainer.style.display = 'none';
            
            try {
                const { mimeType, base64Data, isDataURI, original } = validation;
                originalBase64String = original;
                
                // è§£ç Base64
                const binaryString = atob(base64Data);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                // åˆ›å»ºBlobå¯¹è±¡
                const blob = new Blob([bytes], { type: mimeType });
                const objectUrl = URL.createObjectURL(blob);
                
                // é¢„è§ˆå›¾ç‰‡
                decodeImagePreview.src = objectUrl;
                
                // è·å–å›¾ç‰‡ä¿¡æ¯
                await new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = function() {
                        // ç”Ÿæˆæ–‡ä»¶å
                        const extension = mimeType.split('/')[1] || 'png';
                        decodedFileName = `decoded-image-${Date.now()}.${extension}`;
                        decodedMimeType = mimeType;
                        decodedImageData = objectUrl;
                        
                        // æ›´æ–°è§£ç ä¿¡æ¯
                        decodeStatus.textContent = 'è§£ç æˆåŠŸ';
                        decodeFormat.textContent = mimeType;
                        decodeLength.textContent = base64Data.length;
                        decodeFileSize.textContent = formatFileSize(bytes.length);
                        
                        resolve();
                    };
                    img.onerror = () => {
                        reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„å›¾ç‰‡æ•°æ®'));
                    };
                    img.src = objectUrl;
                });
                
                // æ˜¾ç¤ºé¢„è§ˆ
                decodePreviewContainer.style.display = 'block';
                showToast('Base64è§£ç æˆåŠŸï¼');
                
            } catch (error) {
                console.error('è§£ç é”™è¯¯:', error);
                showError('è§£ç å¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                showToast('è§£ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥Base64ç¼–ç ', 'error');
                decodeStatus.textContent = 'è§£ç å¤±è´¥';
                decodeFormat.textContent = 'æœªçŸ¥';
                decodeLength.textContent = '0';
                decodeFileSize.textContent = '0 Bytes';
            } finally {
                // éšè—åŠ è½½çŠ¶æ€
                decodeLoading.style.display = 'none';
            }
        }

        // ä¸‹è½½è§£ç åçš„å›¾ç‰‡
        function downloadDecodedImage() {
            if (!decodedImageData) {
                showToast('æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡', 'error');
                return;
            }
            
            try {
                const a = document.createElement('a');
                a.href = decodedImageData;
                a.download = decodedFileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showToast('å›¾ç‰‡ä¸‹è½½æˆåŠŸ');
            } catch (error) {
                console.error('ä¸‹è½½å¤±è´¥:', error);
                showToast('ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // å¤åˆ¶åŸå§‹Base64å­—ç¬¦ä¸²
        async function copyOriginalBase64() {
            if (!originalBase64String) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„Base64ç¼–ç ', 'error');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(originalBase64String);
                showToast('Base64ç¼–ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (err) {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = originalBase64String;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('Base64ç¼–ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // åˆ‡æ¢è½¬æ¢æ¨¡å¼
        function switchConversionMode(mode) {
            if (mode === 'toBase64') {
                toBase64Btn.classList.add('active');
                toImageBtn.classList.remove('active');
                toBase64Panel.style.display = 'block';
                toImagePanel.style.display = 'none';
                // æ¸…é™¤Base64è¾“å…¥åŒºåŸŸ
                base64Input.value = '';
                hideError();
                decodePreviewContainer.style.display = 'none';
            } else {
                toBase64Btn.classList.remove('active');
                toImageBtn.classList.add('active');
                toBase64Panel.style.display = 'none';
                toImagePanel.style.display = 'block';
                // æ¸…é™¤æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ
                previewContainer.style.display = 'none';
                fileInput.value = '';
            }
        }

        // æ¸…é™¤Base64è¾“å…¥
        function clearBase64Input() {
            base64Input.value = '';
            hideError();
            decodePreviewContainer.style.display = 'none';
            showToast('å·²æ¸…é™¤è¾“å…¥', 'warning');
        }

        // äº‹ä»¶ç›‘å¬å™¨
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#9d4edd';
            uploadArea.style.background = 'rgba(187, 134, 252, 0.15)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#bb86fc';
            uploadArea.style.background = 'rgba(187, 134, 252, 0.05)';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#bb86fc';
            uploadArea.style.background = 'rgba(187, 134, 252, 0.05)';
            
            if (e.dataTransfer.files.length > 0) {
                handleImageUpload(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        formatRadios.forEach(radio => {
            radio.addEventListener('change', updateBase64Output);
        });

        copyBtn.addEventListener('click', copyToClipboard);
        exportHtmlBtn.addEventListener('click', exportHtml);
        exportCssBtn.addEventListener('click', exportCss);
        resetBtn.addEventListener('click', resetAll);
        
        // æ–°å¢äº‹ä»¶ç›‘å¬å™¨
        toBase64Btn.addEventListener('click', () => switchConversionMode('toBase64'));
        toImageBtn.addEventListener('click', () => switchConversionMode('toImage'));
        
        // è§£ç æŒ‰é’®äº‹ä»¶
        decodeBtn.addEventListener('click', decodeBase64ToImage);
        
        // Base64è¾“å…¥åŒºåŸŸå›è½¦è§£ç 
        base64Input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                decodeBase64ToImage();
            }
        });
        
        downloadImageBtn.addEventListener('click', downloadDecodedImage);
        copyBase64Btn.addEventListener('click', copyOriginalBase64);
        clearBase64Btn.addEventListener('click', clearBase64Input);

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            showToast('æ¬¢è¿ä½¿ç”¨Base64å›¾ç‰‡åŒå‘è½¬æ¢å·¥å…·ï¼');
            
            // ç¤ºä¾‹Base64ç¼–ç 
            const exampleBase64 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
            base64Input.placeholder = `ç²˜è´´Base64ç¼–ç å­—ç¬¦ä¸²æˆ–data URI...\n\nç¤ºä¾‹ï¼š\n${exampleBase64}`;
        });
    </script>
</body>
</html>