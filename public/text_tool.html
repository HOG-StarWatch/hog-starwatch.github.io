<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æå…‰å·¥å…·ç®± (Aurora Toolbox)</title>
    <!-- å¼•å…¥ Crypto-JS -->
    <script src="crypto-js.min.js"></script>
    <!-- å¼•å…¥ UUID -->
    <script src="uuid.min.js"></script>
    <!-- å¼•å…¥ LZ-String -->
    <script src="lz-string.min.js"></script>
    <style>
        :root {
            /* æå…‰é…è‰²æ–¹æ¡ˆ */
            --bg-deep: #0b0f19;
            --bg-panel: rgba(20, 25, 40, 0.75);
            --primary: #c084fc; /* éœ“è™¹ç´« */
            --secondary: #2dd4bf; /* é’è‰²/Teal */
            --accent: #f472b6; /* ç²‰è‰² */
            --text-main: #f1f5f9;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --glass: blur(20px);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            
            --radius-lg: 16px;
            --radius-md: 8px;
            --radius-sm: 4px;
        }

        * {
            box-sizing: border-box;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(192, 132, 252, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(45, 212, 191, 0.15) 0%, transparent 40%);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        header {
            padding: 0 1.5rem;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            background: rgba(11, 15, 25, 0.8);
            backdrop-filter: var(--glass);
            z-index: 10;
        }

        .logo {
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
            white-space: nowrap;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            height: 100%;
            overflow-x: auto;
            scrollbar-width: none; /* Firefox */
        }
        .nav-tabs::-webkit-scrollbar { display: none; }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--text-dim);
            padding: 0 1rem;
            height: 100%;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            transition: color 0.3s;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--text-main);
        }

        .tab-btn.active {
            color: var(--secondary);
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--secondary);
            box-shadow: 0 -2px 8px var(--secondary);
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .tab-pane {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            padding: 1.5rem;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
            overflow-y: auto;
        }

        .tab-pane.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateY(0);
        }

        /* å“åº”å¼å¸ƒå±€å®¹å™¨ */
        .workspace {
            display: flex;
            flex-direction: row;
            gap: 1.5rem;
            height: 100%;
            width: 100%;
            max-width: 1600px;
            margin: 0 auto;
        }

        @media (max-width: 768px) {
            .workspace {
                flex-direction: column;
                height: auto;
            }
            .tab-pane {
                padding: 1rem;
            }
            header {
                padding: 0 1rem;
            }
            .tab-btn {
                padding: 0 0.5rem;
                font-size: 0.8rem;
            }
        }

        /* è¾“å…¥/è¾“å‡ºé¢æ¿ */
        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            min-height: 200px;
        }

        .panel-header {
            padding: 0.8rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            background: rgba(255,255,255,0.02);
        }

        .panel-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-actions {
            display: flex;
            gap: 8px;
        }

        .stat-badge {
            font-size: 0.75rem;
            color: var(--text-dim);
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 4px;
        }

        textarea {
            flex: 1;
            width: 100%;
            background: transparent;
            border: none;
            padding: 1rem;
            color: var(--text-main);
            font-family: 'JetBrains Mono', Consolas, monospace;
            font-size: 0.95rem;
            line-height: 1.6;
            resize: none;
        }
        
        input[type="text"], input[type="password"], select {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            font-family: 'JetBrains Mono', monospace;
        }
        
        select {
            cursor: pointer;
        }

        select option {
            background: #1a1f2e;
            color: var(--text-main);
        }

        textarea::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.2);
        }

        /* å·¥å…·æ  */
        .toolbar {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            overflow-y: auto;
            padding-right: 4px;
        }

        @media (max-width: 768px) {
            .toolbar {
                width: 100%;
                flex-direction: row;
                flex-wrap: wrap;
                max-height: none;
            }
        }

        .tool-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .group-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .btn {
            padding: 0.6rem 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            background: rgba(255,255,255,0.03);
            color: var(--text-main);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .btn:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
            transform: translateX(2px);
        }

        .btn:active {
            transform: translateX(0);
        }

        .btn-primary {
            background: rgba(192, 132, 252, 0.1);
            border-color: rgba(192, 132, 252, 0.3);
            color: var(--primary);
        }
        
        .btn-primary:hover {
            background: rgba(192, 132, 252, 0.2);
            box-shadow: 0 0 15px rgba(192, 132, 252, 0.2);
        }

        .btn-secondary {
            background: rgba(45, 212, 191, 0.1);
            border-color: rgba(45, 212, 191, 0.3);
            color: var(--secondary);
        }

        .btn-icon {
            padding: 4px 8px;
            font-size: 0.8rem;
            border-radius: 4px;
            width: auto;
            display: inline-block;
        }

        /* é€‰é¡¹å¡ç‰¹å®šæ ·å¼ */
        .transcode-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .chip {
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chip.active {
            background: rgba(45, 212, 191, 0.15);
            border-color: var(--secondary);
            color: var(--secondary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e293b;
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-success { border-left: 4px solid var(--secondary); }
        .toast-error { border-left: 4px solid var(--accent); }

        /* File Upload */
        .file-upload {
            position: relative;
            display: inline-block;
        }
        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        /* Generator & Crypto Styles */
        .input-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--text-main);
            margin-bottom: 1rem;
        }
        
        .input-row label {
            min-width: 80px;
            font-weight: 600;
            color: var(--text-dim);
        }
        
        .input-row input[type="range"] {
            flex: 1;
            cursor: pointer;
        }
        
        .checkbox-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            user-select: none;
            color: var(--text-main);
        }
        
        .result-box {
            display: flex;
            gap: 0.5rem;
        }
        
        .result-box input {
            flex: 1;
        }

        .crypto-config {
            background: rgba(0,0,0,0.2);
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }
        
        .sub-tab-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }
        
        .sub-tab {
            padding: 5px 15px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            border-radius: 4px;
        }
        
        .sub-tab.active {
            opacity: 1;
            background: rgba(255,255,255,0.1);
            color: var(--primary);
            font-weight: bold;
        }

        .preview-chars {
            margin-top: 5px;
            font-size: 0.8rem;
            color: var(--text-dim);
            word-break: break-all;
        }

    </style>
</head>
<body>

<header>
    <div class="logo">AURORA <span style="font-weight:300; opacity:0.7">TOOLBOX</span></div>
    <nav class="nav-tabs">
        <button class="tab-btn active" onclick="app.switchTab('text')">æ–‡æœ¬å¤„ç†</button>
        <button class="tab-btn" onclick="app.switchTab('transcode')">å…¨èƒ½è½¬ç </button>
        <button class="tab-btn" onclick="app.switchTab('crypto')">åŠ å¯†è§£å¯†</button>
        <button class="tab-btn" onclick="app.switchTab('markdown')">MD / HTML</button>
        <button class="tab-btn" onclick="app.switchTab('generator')">ç”Ÿæˆå™¨</button>
    </nav>
</header>

<main>
    <!-- Text Processing Tab -->
    <div id="tab-text" class="tab-pane active">
        <div class="workspace">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">è¾“å…¥ <span class="stat-badge" id="text-in-stat">0 å­—ç¬¦</span></div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="app.clear('text')">æ¸…ç©º</button>
                    </div>
                </div>
                <textarea id="text-input" placeholder="åœ¨æ­¤è¾“å…¥æ–‡æœ¬..."></textarea>
            </div>

            <div class="toolbar">
                <div class="tool-group">
                    <div class="group-label">åŸºç¡€</div>
                    <button class="btn" onclick="textTool.process('upper')">å…¨å¤§å†™ <span>AA</span></button>
                    <button class="btn" onclick="textTool.process('lower')">å…¨å°å†™ <span>aa</span></button>
                    <button class="btn" onclick="textTool.process('title')">é¦–å­—æ¯å¤§å†™ <span>Aa</span></button>
                </div>
                <div class="tool-group">
                    <div class="group-label">æ ¼å¼</div>
                    <button class="btn" onclick="textTool.process('trim')">å»é¦–å°¾ç©º <span>|__|</span></button>
                    <button class="btn" onclick="textTool.process('nospace')">å»æ‰€æœ‰ç©ºæ ¼ <span>><</span></button>
                    <button class="btn" onclick="textTool.process('oneline')">åˆå¹¶ä¸ºä¸€è¡Œ <span>â€”</span></button>
                </div>
                <div class="tool-group">
                    <div class="group-label">é«˜çº§</div>
                    <button class="btn" onclick="textTool.process('snake')">Snake Case <span>a_b</span></button>
                    <button class="btn" onclick="textTool.process('camel')">Camel Case <span>aB</span></button>
                    <button class="btn" onclick="textTool.process('dedupe')">å»é‡è¡Œ <span>1,1â†’1</span></button>
                    <button class="btn" onclick="textTool.process('sort')">A-Z æ’åº <span>â†“</span></button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ç»“æœ <span class="stat-badge" id="text-out-stat">0 å­—ç¬¦</span></div>
                    <div class="panel-actions">
                        <button class="btn btn-icon btn-secondary" onclick="app.copy('text-output')">å¤åˆ¶</button>
                    </div>
                </div>
                <textarea id="text-output" readonly placeholder="å¤„ç†ç»“æœ..."></textarea>
            </div>
        </div>
    </div>

    <!-- Transcoder Tab -->
    <div id="tab-transcode" class="tab-pane">
        <div class="transcode-options">
            <div class="chip active" onclick="transcoder.setMode('url', this)">URL</div>
            <div class="chip" onclick="transcoder.setMode('base64', this)">Base64 (UTF-8)</div>
            <div class="chip" onclick="transcoder.setMode('unicode', this)">Unicode (\u)</div>
            <div class="chip" onclick="transcoder.setMode('html', this)">HTMLå®ä½“</div>
            <div class="chip" onclick="transcoder.setMode('hex', this)">Hex (16è¿›åˆ¶)</div>
            <div class="chip" onclick="transcoder.setMode('bin', this)">Binary (2è¿›åˆ¶)</div>
            <div class="chip" onclick="transcoder.setMode('punycode', this)">Punycode</div>
        </div>

        <div class="workspace">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">å¾…è½¬ç </div>
                    <div class="panel-actions">
                        <button class="btn btn-icon" onclick="app.clear('code')">æ¸…ç©º</button>
                    </div>
                </div>
                <textarea id="code-input" placeholder="è¾“å…¥å†…å®¹..."></textarea>
            </div>

            <div class="toolbar">
                <div class="tool-group">
                    <div class="group-label">æ“ä½œ</div>
                    <button class="btn btn-primary" onclick="transcoder.run('encode')">ç¼–ç  (Encode) â†’</button>
                    <button class="btn btn-primary" onclick="transcoder.run('decode')">è§£ç  (Decode) â†</button>
                    <button class="btn" onclick="transcoder.swap()">â†• äº¤æ¢å†…å®¹</button>
                </div>
                <div class="tool-group">
                    <div class="group-label">è¯´æ˜</div>
                    <div style="font-size:0.8rem; color:var(--text-dim); padding:0.5rem; line-height:1.4">
                        å½“å‰æ¨¡å¼ï¼š<span id="current-mode-label" style="color:var(--secondary)">URL</span>
                        <br><br>
                        æ”¯æŒè‡ªåŠ¨æ£€æµ‹éƒ¨åˆ†æ ¼å¼ã€‚Base64æ¨¡å¼å·²ä¼˜åŒ–ä¸­æ–‡æ”¯æŒã€‚
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ç»“æœ</div>
                    <div class="panel-actions">
                        <button class="btn btn-icon btn-secondary" onclick="app.copy('code-output')">å¤åˆ¶</button>
                    </div>
                </div>
                <textarea id="code-output" readonly placeholder="è½¬æ¢ç»“æœ..."></textarea>
            </div>
        </div>
    </div>
    
    <!-- Crypto Tab (New) -->
    <div id="tab-crypto" class="tab-pane">
        <div class="sub-tab-group">
            <div class="sub-tab active" onclick="cryptoTool.switchSubTab('std', this)">æ ‡å‡†åŠ å¯† (AES/DES)</div>
            <div class="sub-tab" onclick="cryptoTool.switchSubTab('custom', this)">è‡ªå®šä¹‰åŠ å¯† (Custom)</div>
            <div class="sub-tab" onclick="cryptoTool.switchSubTab('zerowidth', this)">é›¶å®½éšå†™ (ZeroWidth)</div>
        </div>
        
        <div class="workspace">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">åŠ å¯†é…ç½® & è¾“å…¥</div>
                    <div class="panel-actions">
                         <button class="btn btn-icon" onclick="app.clear('crypto')">æ¸…ç©º</button>
                    </div>
                </div>
                <div style="padding: 1rem; flex: 1; display: flex; flex-direction: column; gap: 1rem;">
                    
                    <!-- Standard Crypto Config -->
                    <div id="crypto-std-config" class="crypto-config">
                        <div class="input-row">
                            <label>ç®—æ³•:</label>
                            <select id="std-algo">
                                <option value="AES">AES</option>
                                <option value="DES">DES</option>
                                <option value="TripleDES">TripleDES</option>
                                <option value="Rabbit">Rabbit</option>
                                <option value="RC4">RC4</option>
                            </select>
                        </div>
                        <div class="input-row">
                            <label>å¯†é’¥:</label>
                            <input type="text" id="std-key" placeholder="åœ¨æ­¤è¾“å…¥å¯†é’¥...">
                        </div>
                    </div>
                    
                    <!-- Custom Crypto Config -->
                    <div id="crypto-custom-config" class="crypto-config" style="display:none;">
                        <div class="input-row">
                            <label>æ¨¡å¼:</label>
                            <select id="custom-mode" onchange="cryptoTool.updateCustomUI()">
                                <option value="16char">16å­—ç¬¦æ˜ å°„ (å­—èŠ‚çº§ - å‹ç¼©ä¼˜åŒ–)</option>
                                <option value="4char">4å­—ç¬¦æ˜ å°„ (ä½æµçº§ - å‹ç¼©ä¼˜åŒ–)</option>
                            </select>
                        </div>
                        
                        <!-- 16 Char Settings -->
                        <div id="custom-16-settings">
                            <div class="input-row">
                                <label>é¢„è®¾:</label>
                                <select id="custom-16-preset" onchange="cryptoTool.apply16Preset()">
                                    <option value="default">é»˜è®¤</option>
                                    <option value="orgasm">æœ¨ç </option>
                                    <option value="sound">æ‹Ÿå£°è¯</option>
                                    <option value="custom">è‡ªå®šä¹‰...</option>
                                </select>
                            </div>
                            <div class="input-row">
                                <label>æ˜ å°„è¡¨:</label>
                                <input type="text" id="custom-16-chars" maxlength="16" placeholder="è¾“å…¥16ä¸ªä¸é‡å¤å­—ç¬¦" value="é½å“¦å™¢å–”å’•å’¿å—¯å•Šï½å“ˆï¼å””å“¼â¤å‘ƒå‘¼">
                            </div>
                        </div>

                        <!-- 4 Char Settings -->
                        <div id="custom-4-settings" style="display:none;">
                            <div class="input-row">
                                <label>é¢„è®¾:</label>
                                <select id="custom-4-preset" onchange="cryptoTool.apply4Preset()">
                                    <option value="default">é»˜è®¤ (HOG~)</option>
                                    <option value="orgasm">é«˜æ½® (å•Šå“ˆå—¯~)</option>
                                    <option value="letters">å­—æ¯ (ABCD)</option>
                                    <option value="symbol">ç¬¦å· (!@#$)</option>
                                    <option value="custom">è‡ªå®šä¹‰...</option>
                                </select>
                            </div>
                            <div class="input-row">
                                <label>å¯†é’¥:</label>
                                <input type="text" id="custom-4-chars" maxlength="4" placeholder="è¾“å…¥4ä¸ªä¸é‡å¤å­—ç¬¦" value="HOG~">
                            </div>
                        </div>
                        
                        <div class="preview-chars" id="custom-preview">å½“å‰å­—ç¬¦é›†: é½å“¦å™¢å–”å’•å’¿å—¯å•Šï½å“ˆï¼å””å“¼â¤å‘ƒå‘¼</div>
                    </div>

                    <!-- Zero Width Config -->
                    <div id="crypto-zerowidth-config" class="crypto-config" style="display:none;">
                        <div style="font-size:0.8rem; color:var(--text-dim); margin-bottom:10px;">
                            å°†éšç§˜ä¿¡æ¯éšè—åœ¨æ™®é€šæ–‡æœ¬ä¸­ï¼Œè‚‰çœ¼ä¸å¯è§ã€‚
                        </div>
                        <div class="input-row">
                            <label>ä¼ªè£…æ–‡æœ¬:</label>
                            <input type="text" id="zw-cover" placeholder="åœ¨æ­¤è¾“å…¥ç”¨äºä¼ªè£…çš„å…¬å¼€æ–‡æœ¬...">
                        </div>
                    </div>
                    
                    <textarea id="crypto-input" placeholder="è¾“å…¥éœ€è¦åŠ å¯†/è§£å¯†çš„å†…å®¹..." style="border: 1px solid var(--border); border-radius: 8px; background: rgba(0,0,0,0.2);"></textarea>
                </div>
            </div>

            <div class="toolbar">
                <div class="tool-group">
                    <div class="group-label">æ“ä½œ</div>
                    <button class="btn btn-primary" onclick="cryptoTool.run('encrypt')">åŠ å¯† (Encrypt) â†’</button>
                    <button class="btn btn-primary" onclick="cryptoTool.run('decrypt')">è§£å¯† (Decrypt) â†</button>
                </div>
                <div class="tool-group">
                    <div class="group-label">ä¿¡æ¯</div>
                    <div style="font-size:0.8rem; color:var(--text-dim); padding:0.5rem; line-height:1.4">
                        æ ‡å‡†åŠ å¯†ä½¿ç”¨ Crypto-JS åº“ã€‚<br>
                        è‡ªå®šä¹‰åŠ å¯†å·²å¯ç”¨ LZString å‹ç¼©ä¼˜åŒ–ã€‚<br>
                        é›¶å®½éšå†™è§£å¯†æ—¶åªéœ€è¾“å…¥å«éšå†™å†…å®¹çš„æ–‡æœ¬ã€‚
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">ç»“æœ</div>
                    <div class="panel-actions">
                        <button class="btn btn-icon btn-secondary" onclick="app.copy('crypto-output')">å¤åˆ¶</button>
                    </div>
                </div>
                <textarea id="crypto-output" readonly placeholder="ç»“æœ..."></textarea>
            </div>
        </div>
    </div>

    <!-- Markdown / HTML Tab -->
    <div id="tab-markdown" class="tab-pane">
        <div class="workspace">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">Markdown / æºç </div>
                    <div class="panel-actions">
                        <div class="file-upload btn btn-icon" style="overflow:hidden">
                            <span>ğŸ“‚ ä¸Šä¼ MD</span>
                            <input type="file" accept=".md,.txt" onchange="mdTool.loadFile(this)">
                        </div>
                        <button class="btn btn-icon" onclick="app.clear('md')">æ¸…ç©º</button>
                    </div>
                </div>
                <textarea id="md-input" placeholder="# æ ‡é¢˜&#10;**åŠ ç²—**&#10;- åˆ—è¡¨..."></textarea>
            </div>

            <div class="toolbar">
                <div class="tool-group">
                    <div class="group-label">è½¬æ¢</div>
                    <button class="btn btn-primary" onclick="mdTool.toHtml()">è½¬ä¸º HTML â†’</button>
                    <button class="btn btn-primary" onclick="mdTool.toMd()">HTML è½¬ MD â†</button>
                </div>
                <div class="tool-group">
                    <div class="group-label">é€‰é¡¹</div>
                    <label style="font-size:0.8rem; display:flex; align-items:center; gap:8px; cursor:pointer; color: var(--text-main);">
                        <input type="checkbox" id="md-escape" checked> è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦
                    </label>
                </div>
                <div class="tool-group">
                    <div class="group-label">æ ‡ç­¾å¯¹ç…§è¡¨</div>
                    <div style="font-size:0.75rem; color:var(--text-dim); display:grid; grid-template-columns: 1fr 1fr; gap:4px; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.2); padding:5px; border-radius:4px;">
                        <span style="color:var(--secondary)"># H1</span> <span>&lt;h1&gt;</span>
                        <span style="color:var(--secondary)">## H2</span> <span>&lt;h2&gt;</span>
                        <span style="color:var(--secondary)">### H3</span> <span>&lt;h3&gt;</span>
                        <span style="color:var(--secondary)">**Bold**</span> <span>&lt;b&gt;</span>
                        <span style="color:var(--secondary)">*Italic*</span> <span>&lt;i&gt;</span>
                        <span style="color:var(--secondary)">> Quote</span> <span>&lt;blockquote&gt;</span>
                        <span style="color:var(--secondary)">`Code`</span> <span>&lt;code&gt;</span>
                        <span style="color:var(--secondary)">```Pre```</span> <span>&lt;pre&gt;</span>
                        <span style="color:var(--secondary)">[Txt](Url)</span> <span>&lt;a&gt;</span>
                        <span style="color:var(--secondary)">---</span> <span>&lt;hr&gt;</span>
                        <span style="color:var(--secondary)">\n\n</span> <span>&lt;br&gt;</span>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">HTML ç»“æœ</div>
                    <div class="panel-actions">
                        <button class="btn btn-icon btn-secondary" onclick="app.copy('md-output')">å¤åˆ¶ä»£ç </button>
                        <button class="btn btn-icon" onclick="mdTool.preview()">é¢„è§ˆ</button>
                    </div>
                </div>
                <textarea id="md-output" placeholder="<h1...>ç»“æœ..."></textarea>
            </div>
        </div>
    </div>
    
    <!-- Generator Tab -->
    <div id="tab-generator" class="tab-pane">
        <div class="workspace">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">å¼ºå¯†ç ç”Ÿæˆå™¨</div>
                </div>
                <div style="padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
                    <div class="input-row">
                        <label>é•¿åº¦: <span id="pwd-len-val" style="color:var(--primary); font-weight:bold;">16</span></label>
                        <input type="range" id="pwd-len" min="4" max="64" value="16" oninput="document.getElementById('pwd-len-val').innerText = this.value">
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="pwd-upper" checked> A-Z</label>
                        <label><input type="checkbox" id="pwd-lower" checked> a-z</label>
                        <label><input type="checkbox" id="pwd-num" checked> 0-9</label>
                        <label><input type="checkbox" id="pwd-sym" checked> !@#</label>
                    </div>
                    <button class="btn btn-primary" style="justify-content:center" onclick="genTool.password()">ç”Ÿæˆå¯†ç </button>
                    <div class="result-box">
                        <input type="text" id="pwd-result" readonly placeholder="ç”Ÿæˆçš„å¯†ç ...">
                        <button class="btn btn-icon" onclick="app.copy('pwd-result')">å¤åˆ¶</button>
                    </div>
                    <textarea id="pwd-batch" readonly placeholder="æ‰¹é‡ç”Ÿæˆç»“æœ (10ä¸ª)..." style="height: 150px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top:10px;"></textarea>
                    <button class="btn btn-secondary" style="justify-content:center" onclick="genTool.passwordBatch()">æ‰¹é‡ç”Ÿæˆ (10ä¸ª)</button>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">UUID ç”Ÿæˆå™¨</div>
                </div>
                <div style="padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
                    <div class="input-row">
                        <label>ç‰ˆæœ¬:</label>
                        <select id="uuid-version" onchange="genTool.updateUuidUI()">
                            <option value="v4">v4 (éšæœº)</option>
                            <option value="v1">v1 (æ—¶é—´æˆ³)</option>
                            <option value="v3">v3 (MD5 å‘½åç©ºé—´)</option>
                            <option value="v5">v5 (SHA-1 å‘½åç©ºé—´)</option>
                        </select>
                    </div>
                    
                    <div id="uuid-ns-group" style="display:none">
                        <div class="input-row">
                            <label>ç©ºé—´:</label>
                            <select id="uuid-ns-type" onchange="genTool.updateNsUI()">
                                <option value="url">URL</option>
                                <option value="dns">DNS</option>
                                <option value="oid">OID</option>
                                <option value="x500">X500</option>
                                <option value="custom">è‡ªå®šä¹‰UUID</option>
                            </select>
                        </div>
                         <div class="input-row" id="uuid-ns-custom-row" style="display:none">
                            <label>NS UUID:</label>
                            <input type="text" id="uuid-ns-custom" placeholder="è¾“å…¥åˆæ³•çš„ UUID...">
                        </div>
                        <div class="input-row">
                            <label>åå­—:</label>
                            <input type="text" id="uuid-name" placeholder="è¾“å…¥ç”¨äºå“ˆå¸Œçš„åå­—...">
                        </div>
                    </div>

                    <button class="btn btn-primary" style="justify-content:center" onclick="genTool.uuid()">ç”Ÿæˆ UUID</button>
                    <div class="result-box">
                        <input type="text" id="uuid-result" readonly placeholder="ç”Ÿæˆçš„ UUID...">
                        <button class="btn btn-icon" onclick="app.copy('uuid-result')">å¤åˆ¶</button>
                    </div>
                    <textarea id="uuid-batch" readonly placeholder="æ‰¹é‡ç”Ÿæˆç»“æœ (10ä¸ª)..." style="height: 150px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-top:10px;"></textarea>
                    <button class="btn btn-secondary" style="justify-content:center" onclick="genTool.uuidBatch()">æ‰¹é‡ç”Ÿæˆ (10ä¸ª)</button>
                </div>
            </div>
        </div>
    </div>

</main>

<div id="toast" class="toast">æ“ä½œæˆåŠŸ</div>

<script>
    /**
     * Core Application Logic
     */
    const app = {
        init: function() {
            // Bind Input Listeners for stats
            const txtInput = document.getElementById('text-input');
            if(txtInput) {
                txtInput.addEventListener('input', (e) => {
                    document.getElementById('text-in-stat').innerText = `${e.target.value.length} å­—ç¬¦`;
                });
            }
            
            // Init Crypto Presets
            cryptoTool.updateCustomUI();
        },

        switchTab: function(tabId) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
        },

        showToast: function(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.className = `toast toast-${type} show`;
            t.innerText = msg;
            setTimeout(() => t.classList.remove('show'), 2000);
        },

        copy: function(elementId) {
            const el = document.getElementById(elementId);
            if (!el.value) return;
            el.select();
            document.execCommand('copy');
            this.showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        },

        clear: function(prefix) {
            const inp = document.getElementById(`${prefix}-input`);
            if(inp) inp.value = '';
            
            const out = document.getElementById(`${prefix}-output`);
            if(out) out.value = '';
            
            if(prefix === 'text') {
                document.getElementById('text-in-stat').innerText = '0 å­—ç¬¦';
                document.getElementById('text-out-stat').innerText = '0 å­—ç¬¦';
            }
            this.showToast('å·²æ¸…ç©º');
        }
    };

    /**
     * Text Processing Module
     */
    const textTool = {
        process: function(action) {
            const input = document.getElementById('text-input').value;
            let res = input;

            switch(action) {
                case 'upper': res = input.toUpperCase(); break;
                case 'lower': res = input.toLowerCase(); break;
                case 'title': res = input.replace(/\b\w/g, c => c.toUpperCase()); break;
                case 'trim': res = input.trim(); break;
                case 'nospace': res = input.replace(/\s+/g, ''); break;
                case 'oneline': res = input.replace(/[\r\n]+/g, ' '); break;
                case 'snake': 
                    res = input.replace(/([A-Z])/g, "_$1").toLowerCase().replace(/^_/, '').replace(/\s+/g, '_');
                    break;
                case 'camel':
                    res = input.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g, (m, chr) => chr.toUpperCase());
                    break;
                case 'dedupe':
                    res = [...new Set(input.split('\n'))].join('\n');
                    break;
                case 'sort':
                    res = input.split('\n').sort().join('\n');
                    break;
            }

            document.getElementById('text-output').value = res;
            document.getElementById('text-out-stat').innerText = `${res.length} å­—ç¬¦`;
        }
    };

    /**
     * Transcoder Module
     */
    const transcoder = {
        mode: 'url',

        setMode: function(m, el) {
            this.mode = m;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('current-mode-label').innerText = el.innerText;
        },

        run: function(action) {
            const input = document.getElementById('code-input').value;
            let res = '';

            try {
                if (this.mode === 'url') {
                    res = action === 'encode' ? encodeURIComponent(input) : decodeURIComponent(input);
                } else if (this.mode === 'base64') {
                    if (action === 'encode') {
                        res = btoa(unescape(encodeURIComponent(input)));
                    } else {
                        res = decodeURIComponent(escape(atob(input)));
                    }
                } else if (this.mode === 'unicode') {
                    if (action === 'encode') {
                        res = input.split('').map(c => '\\u' + c.charCodeAt(0).toString(16).padStart(4, '0')).join('');
                    } else {
                        res = input.replace(/\\u[\dA-F]{4}/gi, match => String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16)));
                    }
                } else if (this.mode === 'html') {
                    if (action === 'encode') {
                        res = input.replace(/[\u00A0-\u9999<>&]/g, i => '&#'+i.charCodeAt(0)+';');
                    } else {
                        const doc = new DOMParser().parseFromString(input, "text/html");
                        res = doc.documentElement.textContent;
                    }
                } else if (this.mode === 'hex') {
                    if (action === 'encode') {
                        res = input.split('').map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' ');
                    } else {
                        res = input.replace(/\s+/g, '').match(/.{1,2}/g).map(byte => String.fromCharCode(parseInt(byte, 16))).join('');
                    }
                } else if (this.mode === 'bin') {
                    if (action === 'encode') {
                        res = input.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' ');
                    } else {
                        res = input.replace(/\s+/g, '').match(/.{1,8}/g).map(byte => String.fromCharCode(parseInt(byte, 2))).join('');
                    }
                } else if (this.mode === 'punycode') {
                    if (action === 'encode') {
                         const u = new URL('http://' + input);
                         res = u.hostname; 
                         if(!res.includes('xn--')) res = "æ³¨ï¼šä»…æ”¯æŒåŸŸåPunycodeè½¬æ¢";
                    } else {
                        res = "æç¤ºï¼šå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨åœ°å€æ ä¼šè‡ªåŠ¨è§£ç Punycodeã€‚";
                    }
                }
            } catch (e) {
                res = "é”™è¯¯: " + e.message;
                app.showToast('è½¬æ¢å‡ºé”™', 'error');
            }
            document.getElementById('code-output').value = res;
        },

        swap: function() {
            const inp = document.getElementById('code-input');
            const out = document.getElementById('code-output');
            [inp.value, out.value] = [out.value, inp.value];
        }
    };

    /**
     * Crypto Tool Module
     */
    const cryptoTool = {
        subTab: 'std',
        
        switchSubTab: function(tab, el) {
            this.subTab = tab;
            document.querySelectorAll('#tab-crypto .sub-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            document.getElementById('crypto-std-config').style.display = 'none';
            document.getElementById('crypto-custom-config').style.display = 'none';
            document.getElementById('crypto-zerowidth-config').style.display = 'none';

            if(tab === 'std') {
                document.getElementById('crypto-std-config').style.display = 'block';
            } else if(tab === 'custom') {
                document.getElementById('crypto-custom-config').style.display = 'block';
            } else {
                document.getElementById('crypto-zerowidth-config').style.display = 'block';
            }
        },
        
        updateCustomUI: function() {
            const mode = document.getElementById('custom-mode').value;
            if(mode === '16char') {
                document.getElementById('custom-16-settings').style.display = 'block';
                document.getElementById('custom-4-settings').style.display = 'none';
                this.updatePreview('16');
            } else {
                document.getElementById('custom-16-settings').style.display = 'none';
                document.getElementById('custom-4-settings').style.display = 'block';
                this.updatePreview('4');
            }
        },
        
        updatePreview: function(type) {
            const chars = document.getElementById(`custom-${type}-chars`).value;
            document.getElementById('custom-preview').innerText = `å½“å‰å­—ç¬¦é›†: ${chars}`;
        },
        
        apply16Preset: function() {
            const presets = {
                default: '0123456789abcdef',
                orgasm: 'é½å“¦å•Šå—¯å‘ƒå“ˆå‘œå’¦å””å“¼å’•å’¯å–”å™¢~â¤',
                sound: 'å–µå‘œå—·å–”å˜å¼å—¯å•Šå””å“¼å‘ƒå‘¼å“ˆ!~â¤',
                custom: ''
            };
            const val = document.getElementById('custom-16-preset').value;
            if(val !== 'custom') {
                document.getElementById('custom-16-chars').value = presets[val];
                this.updatePreview('16');
            }
        },
        
        apply4Preset: function() {
            const presets = {
                default: 'HOG~',
                orgasm: 'å•Šå“ˆå—¯~',
                letters: 'ABCD',
                symbol: '!@#$',
                custom: ''
            };
            const val = document.getElementById('custom-4-preset').value;
            if(val !== 'custom') {
                document.getElementById('custom-4-chars').value = presets[val];
                this.updatePreview('4');
            }
        },

        run: function(action) {
            const input = document.getElementById('crypto-input').value;
            if(!input) return;
            
            let res = '';
            
            try {
                if(this.subTab === 'std') {
                    // Standard Crypto using CryptoJS
                    if(typeof CryptoJS === 'undefined') {
                        throw new Error("CryptoJS åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥");
                    }
                    const algo = document.getElementById('std-algo').value;
                    const key = document.getElementById('std-key').value;
                    
                    if(!key) throw new Error("è¯·è¾“å…¥å¯†é’¥");
                    
                    if(action === 'encrypt') {
                        res = CryptoJS[algo].encrypt(input, key).toString();
                    } else {
                        const bytes = CryptoJS[algo].decrypt(input, key);
                        res = bytes.toString(CryptoJS.enc.Utf8);
                        if(!res) throw new Error("è§£å¯†å¤±è´¥ï¼Œå¯†é’¥é”™è¯¯æˆ–å†…å®¹æŸå");
                    }
                } else if(this.subTab === 'custom') {
                    // Custom Crypto
                    const mode = document.getElementById('custom-mode').value;
                    if(mode === '16char') {
                        res = this.run16Char(action, input);
                    } else {
                        res = this.run4Char(action, input);
                    }
                } else {
                    // Zero Width Crypto
                    res = this.runZeroWidth(action, input);
                }
            } catch(e) {
                res = "é”™è¯¯: " + e.message;
                app.showToast('æ“ä½œå¤±è´¥', 'error');
                console.error(e);
            }
            
            document.getElementById('crypto-output').value = res;
        },
        
        // å‹ç¼©è¾…åŠ©å‡½æ•°
        compress: function(str) {
            if(typeof LZString === 'undefined') return str;
            return LZString.compressToUint8Array(str);
        },
        
        decompress: function(uint8Array) {
            if(typeof LZString === 'undefined') return new TextDecoder().decode(uint8Array);
            const res = LZString.decompressFromUint8Array(uint8Array);
            return res || new TextDecoder().decode(uint8Array); // Fallback if not compressed
        },

        run16Char: function(action, input) {
            let charset = document.getElementById('custom-16-chars').value;
            if(new Set(charset).size !== 16) throw new Error("16å­—ç¬¦é›†å¿…é¡»åŒ…å«16ä¸ªä¸é‡å¤å­—ç¬¦");
            
            if(action === 'encrypt') {
                // Compress first
                const bytes = this.compress(input);
                // If compress failed or not loaded, fallback to utf8
                const data = bytes instanceof Uint8Array ? bytes : new TextEncoder().encode(input);
                
                let encoded = '';
                for(let byte of data) {
                    encoded += charset[(byte >> 4) & 0x0F] + charset[byte & 0x0F];
                }
                return `#CHARSET=${charset}\n${encoded}`;
            } else {
                // Decrypt
                if(input.startsWith('#CHARSET=')) {
                    const idx = input.indexOf('\n');
                    if(idx > -1) {
                        charset = input.substring(9, idx);
                        input = input.substring(idx + 1);
                    }
                }
                if(input.length % 2 !== 0) throw new Error("æ— æ•ˆçš„ç¼–ç é•¿åº¦");
                
                const map = {};
                for(let i=0; i < 16; i++) map[charset[i]] = i;
                
                const bytes = [];
                for(let i=0; i < input.length; i+=2) {
                    const h = map[input[i]];
                    const l = map[input[i+1]];
                    if(h === undefined || l === undefined) throw new Error(`å­—ç¬¦é›†ä¸­æœªæ‰¾åˆ°å­—ç¬¦: ${input[i]}${input[i+1]}`);
                    bytes.push((h << 4) | l);
                }
                
                return this.decompress(new Uint8Array(bytes));
            }
        },
        
        run4Char: function(action, input) {
            let keys = document.getElementById('custom-4-chars').value;
            if(new Set(keys).size !== 4) throw new Error("4å­—ç¬¦å¯†é’¥å¿…é¡»åŒ…å«4ä¸ªä¸é‡å¤å­—ç¬¦");
            
            // Map 00, 01, 10, 11
            const bitMap = [keys[0], keys[1], keys[2], keys[3]];
            
            if(action === 'encrypt') {
                // Compress
                const bytes = this.compress(input);
                const data = bytes instanceof Uint8Array ? bytes : new TextEncoder().encode(input);

                let res = '';
                for(let byte of data) {
                    // 1 byte = 8 bits = 4 chars (2 bits per char)
                    res += bitMap[(byte >> 6) & 0x03];
                    res += bitMap[(byte >> 4) & 0x03];
                    res += bitMap[(byte >> 2) & 0x03];
                    res += bitMap[byte & 0x03];
                }
                return `${keys}|${res}`;
            } else {
                if(input.includes('|')) {
                    const parts = input.split('|');
                    keys = parts[0];
                    input = parts[1];
                }
                
                const revMap = {};
                for(let i=0; i < 4; i++) revMap[keys[i]] = i;
                
                const bytes = [];
                if(input.length % 4 !== 0) throw new Error("å†…å®¹é•¿åº¦ä¸åŒ¹é…ï¼Œå¯èƒ½æŸå");
                
                for(let i=0; i < input.length; i+=4) {
                    let val = 0;
                    for(let j=0; j<4; j++) {
                        const char = input[i+j];
                        if(revMap[char] === undefined) throw new Error(`æ— æ•ˆå­—ç¬¦: ${char}`);
                        val = (val << 2) | revMap[char];
                    }
                    bytes.push(val);
                }
                
                return this.decompress(new Uint8Array(bytes));
            }
        },

        runZeroWidth: function(action, input) {
            const zw = {
                space: '\u200B', // Zero Width Space (0)
                joiner: '\u200C' // Zero Width Non-Joiner (1)
            };
            
            if(action === 'encrypt') {
                const cover = document.getElementById('zw-cover').value || "è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬ã€‚";
                
                // Text -> Binary
                let bin = '';
                for(let i=0; i<input.length; i++) {
                    bin += input.charCodeAt(i).toString(2).padStart(16, '0');
                }
                
                let hidden = '';
                for(let b of bin) {
                    hidden += (b === '0' ? zw.space : zw.joiner);
                }
                
                // Insert hidden after first char of cover
                if(cover.length > 0) {
                    return cover[0] + hidden + cover.slice(1);
                } else {
                    return hidden;
                }
            } else {
                // Extract
                let bin = '';
                for(let char of input) {
                    if(char === zw.space) bin += '0';
                    else if(char === zw.joiner) bin += '1';
                }
                
                if(!bin) return "æœªæ£€æµ‹åˆ°éšå†™ä¿¡æ¯";
                
                let res = '';
                for(let i=0; i<bin.length; i+=16) {
                    res += String.fromCharCode(parseInt(bin.substr(i, 16), 2));
                }
                return res;
            }
        }
    };

    /**
     * Markdown Tool Module
     */
    const mdTool = {
        loadFile: function(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('md-input').value = e.target.result;
                app.showToast('æ–‡ä»¶åŠ è½½æˆåŠŸ');
            };
            reader.readAsText(file);
        },

        escapeHtml: function(unsafe) {
            return unsafe
                 .replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
        },

        toHtml: function() {
            let md = document.getElementById('md-input').value;
            const shouldEscape = document.getElementById('md-escape').checked;
            
            // Basic Regex Markdown Parser
            if (shouldEscape) {
                // Placeholder for more complex escaping if needed
            }

            let html = md;
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
            html = html.replace(/\*\*(.*)\*\*/gim, '<b>$1</b>');
            html = html.replace(/\*(.*)\*/gim, '<i>$1</i>');
            html = html.replace(/```([\s\S]*?)```/gim, (match, code) => {
                return '<pre><code>' + (shouldEscape ? mdTool.escapeHtml(code) : code) + '</code></pre>';
            });
            html = html.replace(/`([^`]+)`/gim, (match, code) => {
                return '<code>' + (shouldEscape ? mdTool.escapeHtml(code) : code) + '</code>';
            });
            html = html.replace(/\[(.*?)\]\((.*?)\)/gim, "<a href='$2'>$1</a>");
            html = html.replace(/^---$/gim, '<hr>');
            html = html.replace(/\n\n/g, '<br><br>');

            document.getElementById('md-output').value = html;
        },

        toMd: function() {
            let html = document.getElementById('md-input').value;
            let md = html
                .replace(/<h1>(.*?)<\/h1>/gim, '# $1\n')
                .replace(/<h2>(.*?)<\/h2>/gim, '## $1\n')
                .replace(/<b>(.*?)<\/b>/gim, '**$1**')
                .replace(/<strong>(.*?)<\/strong>/gim, '**$1**')
                .replace(/<i>(.*?)<\/i>/gim, '*$1*')
                .replace(/<a href=['"](.*?)['"]>(.*?)<\/a>/gim, '[$2]($1)')
                .replace(/<br>/gim, '\n');
            document.getElementById('md-output').value = md;
        },
        
        preview: function() {
            const html = document.getElementById('md-output').value;
            const win = window.open("", "Preview", "width=800,height=600");
            win.document.write('<' + 'html><' + 'head><' + 'title>Preview</' + 'title>');
            win.document.write('<' + 'style>body{font-family:sans-serif;padding:2rem;line-height:1.6;color:#333}</' + 'style>');
            win.document.write('</' + 'head><' + 'body>');
            win.document.write(html);
            win.document.write('</' + 'body></' + 'html>');
            win.document.close();
        }
    };
    
    /**
     * Generator Tool Module
     */
    const genTool = {
        password: function() {
            const len = parseInt(document.getElementById('pwd-len').value);
            const useUpper = document.getElementById('pwd-upper').checked;
            const useLower = document.getElementById('pwd-lower').checked;
            const useNum = document.getElementById('pwd-num').checked;
            const useSym = document.getElementById('pwd-sym').checked;
            
            let chars = '';
            if(useUpper) chars += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if(useLower) chars += 'abcdefghijklmnopqrstuvwxyz';
            if(useNum) chars += '0123456789';
            if(useSym) chars += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            if(!chars) {
                app.showToast('è¯·è‡³å°‘é€‰æ‹©ä¸€ç§å­—ç¬¦ç±»å‹', 'error');
                return;
            }
            
            let pwd = '';
            const array = new Uint32Array(len);
            window.crypto.getRandomValues(array);
            for(let i = 0; i < len; i++) {
                pwd += chars[array[i] % chars.length];
            }
            document.getElementById('pwd-result').value = pwd;
            return pwd;
        },
        
        passwordBatch: function() {
            let res = [];
            for(let i=0; i<10; i++) {
                res.push(this.password());
            }
            document.getElementById('pwd-batch').value = res.join('\n');
        },
        
        updateUuidUI: function() {
            const ver = document.getElementById('uuid-version').value;
            const nsGroup = document.getElementById('uuid-ns-group');
            if(ver === 'v3' || ver === 'v5') {
                nsGroup.style.display = 'block';
            } else {
                nsGroup.style.display = 'none';
            }
        },

        updateNsUI: function() {
            const type = document.getElementById('uuid-ns-type').value;
            const customRow = document.getElementById('uuid-ns-custom-row');
            const nsInput = document.getElementById('uuid-ns-custom');
            const nameInput = document.getElementById('uuid-name');
            
            if(type === 'custom') {
                customRow.style.display = 'flex';
                nsInput.placeholder = "è¾“å…¥åˆæ³•çš„ UUID (ä¾‹å¦‚: 6ba7b810-9dad-11d1-80b4-00c04fd430c8)";
            } else {
                customRow.style.display = 'none';
            }

            if(type === 'url') nameInput.placeholder = "è¾“å…¥ URL (ä¾‹å¦‚: https://example.com)";
            else if(type === 'dns') nameInput.placeholder = "è¾“å…¥ åŸŸå (ä¾‹å¦‚: example.com)";
            else if(type === 'oid') nameInput.placeholder = "è¾“å…¥ OID (ä¾‹å¦‚: 1.3.6.1.4.1...)";
            else if(type === 'x500') nameInput.placeholder = "è¾“å…¥ X500 DN (ä¾‹å¦‚: CN=John Doe, C=US)";
            else nameInput.placeholder = "è¾“å…¥ç”¨äºå“ˆå¸Œçš„åå­—...";
        },

        uuid: function() {
            const ver = document.getElementById('uuid-version').value;
            let res = '';
            
            try {
                if(typeof uuid === 'undefined') {
                    // Fallback to randomUUID if lib not loaded (only for v4)
                    if(ver === 'v4') res = crypto.randomUUID();
                    else throw new Error("UUID åº“æœªåŠ è½½ï¼Œä»…æ”¯æŒ v4");
                } else {
                    if(ver === 'v4') {
                        res = uuid.v4();
                    } else if(ver === 'v1') {
                        res = uuid.v1();
                    } else if(ver === 'v3' || ver === 'v5') {
                        const name = document.getElementById('uuid-name').value;
                        if(!name) throw new Error("è¯·è¾“å…¥åå­—");
                        
                        let ns = uuid.URL; // default
                        const type = document.getElementById('uuid-ns-type').value;
                        if(type === 'dns') ns = uuid.DNS;
                        else if(type === 'oid') ns = uuid.OID;
                        else if(type === 'x500') ns = '6ba7b814-9dad-11d1-80b4-00c04fd430c8'; // X500 not in lib constants sometimes
                        else if(type === 'custom') {
                            ns = document.getElementById('uuid-ns-custom').value;
                            if(!uuid.validate(ns)) throw new Error("æ— æ•ˆçš„å‘½åç©ºé—´ UUID");
                        }
                        
                        res = uuid[ver](name, ns);
                    }
                }
            } catch(e) {
                app.showToast(e.message, 'error');
                return;
            }
            
            document.getElementById('uuid-result').value = res;
        },

        uuidBatch: function() {
            let res = [];
            // Simple batch for v4 only for now, or use current settings?
            // Let's use current settings
            for(let i = 0; i < 10; i++) {
                this.uuid();
                res.push(document.getElementById('uuid-result').value);
            }
            document.getElementById('uuid-batch').value = res.join('\n');
        }
    };

    app.init();
</script>

</body>
</html>
